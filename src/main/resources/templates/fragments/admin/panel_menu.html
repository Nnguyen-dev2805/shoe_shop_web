<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="header">
    <div class="main-nav">
        <!-- Sidebar Logo -->
        <div class="logo-box">
            <a href="" class="logo-dark">
                <img src="/assets/images/logo-sm.png" class="logo-sm" alt="logo sm">
                <img src="/assets/images/logo-dark-1.png" class="logo-lg" alt="logo dark">

            </a>

            <a href="" class="logo-light">
                <img src="/assets/images/logo-sm.png" class="logo-sm" alt="logo sm">
                <img src="/assets/images/logo-light-1.png" class="logo-lg" alt="logo light">
            </a>
        </div>

        <!-- Menu Toggle Button (sm-hover) -->
        <button type="button" class="button-sm-hover" aria-label="Show Full Sidebar">
            <iconify-icon icon="solar:double-alt-arrow-right-bold-duotone" class="button-sm-hover-icon"></iconify-icon>
        </button>

        <div class="scrollbar" data-simplebar>
            <ul class="navbar-nav" id="navbar-nav">

                <li class="menu-title">Tổng quan</li>

                <li class="nav-item">
                    <a class="nav-link" href="/admin">
                                   <span class="nav-icon">
                                        <iconify-icon icon="solar:widget-5-bold-duotone"></iconify-icon>
                                   </span>
                        <span class="nav-text"> Thống Kê </span>
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarProducts" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarProducts">
                                   <span class="nav-icon">
                                        <iconify-icon icon="solar:t-shirt-bold-duotone"></iconify-icon>
                                   </span>
                        <span class="nav-text"> Sản Phẩm </span>
                    </a>
                    <div class="collapse" id="sidebarProducts">
                        <ul class="nav sub-navbar-nav">
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/product">Danh Sách Sản Phẩm</a>
                            </li>
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/product/insert">Thêm Sản Phẩm</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarCategory" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarCategory">
                                   <span class="nav-icon">
                                        <iconify-icon icon="solar:clipboard-list-bold-duotone"></iconify-icon>
                                   </span>
                        <span class="nav-text"> Danh Mục </span>
                    </a>
                    <div class="collapse" id="sidebarCategory">
                        <ul class="nav sub-navbar-nav">
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/category">Danh Sách Danh Mục</a>
                            </li>
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/category/insert">Thêm Danh Mục</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarBrand" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarBrand">
                                   <span class="nav-icon">
                                        <iconify-icon icon="solar:tag-bold-duotone"></iconify-icon>
                                   </span>
                        <span class="nav-text"> Thương Hiệu </span>
                    </a>
                    <div class="collapse" id="sidebarBrand">
                        <ul class="nav sub-navbar-nav">
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/brand">Danh Sách Thương Hiệu</a>
                            </li>
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/brand/insert">Thêm Thương Hiệu</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarInventory" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarInventory">
                                   <span class="nav-icon">
                                        <iconify-icon icon="solar:box-bold-duotone"></iconify-icon>
                                   </span>
                        <span class="nav-text"> Tồn Kho </span>
                    </a>
                    <div class="collapse" id="sidebarInventory">
                        <ul class="nav sub-navbar-nav">

                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/inventory">Danh Sách Tồn Kho</a>
                            </li>
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/inventory/insert">Thêm Tồn Kho</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarOrders" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarOrders">
                                   <span class="nav-icon">
                                        <iconify-icon icon="solar:bag-smile-bold-duotone"></iconify-icon>
                                   </span>
                        <span class="nav-text"> Đơn Hàng </span>
                        <!-- WebSocket Notification Badge -->
                        <span id="order-notification-badge" class="badge bg-danger rounded-pill ms-2" style="display:none; font-size: 0.65rem; animation: pulse 1s ease-in-out infinite;">0</span>
                    </a>
                    <div class="collapse" id="sidebarOrders">
                        <ul class="nav sub-navbar-nav">

                            <li class="sub-nav-item">
                                <a class="sub-nav-link" th:href="@{/admin/order/list}">Danh Sách Đơn Hàng</a>
                            </li>

                            <li class="sub-nav-item">
                                <a class="sub-nav-link return-request-menu" th:href="@{/admin/returns}">
                                    <i></i> Yêu Cầu Trả Hàng
                                    <span id="return-pending-badge" class="badge rounded-pill ms-2" style="
                                        background: #ff6b35;
                                        color: white;
                                        font-size: 11px;
                                        font-weight: 600;
                                        min-width: 20px;
                                        height: 20px;
                                        display: none;
                                        align-items: center;
                                        justify-content: center;
                                        padding: 0 6px;
                                        line-height: 1;
                                    ">0</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarDiscount" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarDiscount">
                    <span class="nav-icon">
                        <iconify-icon icon="mdi:tag-heart-outline"></iconify-icon>

                    </span>
                        <span class="nav-text"> Mã Giảm Giá </span>
                    </a>

                    <div class="collapse" id="sidebarDiscount">
                        <ul class="nav sub-navbar-nav">
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/discount-list">Danh Sách Mã Giảm Giá</a>
                            </li>
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/discount-add">Thêm Mã Giảm Giá</a>
                            </li>
                        </ul>
                    </div>
                </li>
                
                <!-- Flash Sale Menu - Ngang cấp với Mã Giảm Giá -->
                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarFlashSale" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarFlashSale">
                    <span class="nav-icon">
                        <iconify-icon icon="solar:fire-bold-duotone"></iconify-icon>
                    </span>
                        <span class="nav-text"> Flash Sale </span>
                    </a>

                    <div class="collapse" id="sidebarFlashSale">
                        <ul class="nav sub-navbar-nav">
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/flash-sale-list">
                                    Danh Sách Flash Sale
                                </a>
                            </li>
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/flash-sale-add">
                                    Thêm Flash Sale
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/admin/permission">
                                   <span class="nav-icon">
                                        <iconify-icon icon="mdi:account"></iconify-icon>
                                   </span>
                        <span class="nav-text"> Phân Quyền </span>
                    </a>
                </li>
                
                <!-- Commented out: Đơn Vị Vận Chuyển -->
                <!--
                <li class="nav-item">
                    <a class="nav-link menu-arrow" href="#sidebarShippingCompany" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="sidebarShippingCompany">
                    <span class="nav-icon">
                        <iconify-icon icon="mdi:truck-delivery-outline"></iconify-icon>
                    </span>
                        <span class="nav-text"> Đơn Vị Vận Chuyển </span>
                    </a>

                    <div class="collapse" id="sidebarShippingCompany">
                        <ul class="nav sub-navbar-nav">
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/shipping_company/list">Danh Sách Đơn Vị Vận Chuyển</a>
                            </li>
                            <li class="sub-nav-item">
                                <a class="sub-nav-link" href="/admin/shipping_company/add">Thêm Đơn Vị Vận Chuyển</a>
                            </li>
                        </ul>
                    </div>
                </li>
                -->

                <!-- <li class="menu-title">Hệ Thống</li> -->

                <li class="nav-item">
                    <a class="nav-link" href="/admin/settings">
                        <span class="nav-icon">
                            <iconify-icon icon="mdi:warehouse"></iconify-icon>
                        </span>
                        <span class="nav-text"> Quản Lý Kho </span>
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="/admin/shipping-rates">
                        <span class="nav-icon">
                            <iconify-icon icon="mdi:currency-usd"></iconify-icon>
                        </span>
                        <span class="nav-text"> Phí Ship </span>
                    </a>
                </li>

                <li class="nav-item">
                    <a th:href="@{/logout}" class="nav-link" href="pages-profile.html">
                        <span class="nav-text"> Đăng Xuất </span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    
    <!-- Load Return Request Pending Count -->
    <script>
    $(document).ready(function() {
        // Highlight active menu based on current URL
        var currentPath = window.location.pathname;
        if (currentPath.includes('/admin/returns')) {
            $('.return-request-menu').addClass('active');
        }
        
        // Load pending return requests count
        $.ajax({
            url: '/admin/returns/api/statistics',
            type: 'GET',
            success: function(data) {
                if (data.pending > 0) {
                    $('#return-pending-badge').text(data.pending);
                    $('#return-pending-badge').css('display', 'inline-flex');
                } else {
                    $('#return-pending-badge').hide();
                }
            },
            error: function() {
                $('#return-pending-badge').hide();
            }
        });
    });
    </script>
</div>

<!-- ========== WebSocket Notifications (Loaded on ALL Admin Pages) ========== -->
<div th:replace="~{fragments/admin/websocket-notifications :: websocket}"></div>