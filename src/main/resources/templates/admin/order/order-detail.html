<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Chi tiết đơn hàng | DeeG Shop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    
    <!-- App favicon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    
    <!-- Vendor css -->
    <link href="/assets/css/vendor.min.css" rel="stylesheet" type="text/css" />
    
    <!-- Icons css -->
    <link href="/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    
    <!-- App css -->
    <link href="/assets/css/app.min.css" rel="stylesheet" type="text/css" />
    
    <!-- Shopee Admin Order Detail CSS -->
    <link href="/css/admin-order-detail-shopee.css" rel="stylesheet" type="text/css" />
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Theme Config js -->
    <script src="/assets/js/config.js"></script>
</head>

<body>

<!-- START Wrapper -->
<div class="wrapper">
    <!-- ========== App Menu Start ========== -->
    <div th:insert="~{fragments/admin/panel_menu.html}"></div>
    <!-- ========== App Menu End ========== -->

    <!-- Start Page Content -->
    <div class="page-content">
        <div class="order-detail-container">
        
            <!-- Status Banner (Full Width) -->
            <div id="statusBanner" class="status-banner IN_STOCK shopee-card">
                <p class="status-text" id="statusText">Đơn hàng đang chờ xử lý</p>
            </div>
            
            <!-- 2-Column Layout -->
            <div class="order-layout">
            
                <!-- ========== MAIN CONTENT (LEFT) ========== -->
                <div class="main-content">
                
                    <!-- Order Info Card -->
                    <div class="shopee-card">
                        <div class="card-padding">
                            <h3 class="section-title">
                                <i class='bx bx-receipt'></i> Thông tin đơn hàng #<span id="orderId">...</span>
                            </h3>
                            
                            <div class="info-row">
                                <span class="info-label"><i class='bx bx-calendar'></i> Ngày tạo</span>
                                <span class="info-value" id="orderCreatedDate">...</span>
                            </div>
                            
                            <div class="info-row">
                                <span class="info-label"><i class='bx bx-credit-card'></i> Phương thức thanh toán</span>
                                <span class="info-value" id="orderPayOption">...</span>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="action-buttons" style="margin-top: 16px;">
                                <button id="cancelBtn" class="btn-cancel">
                                    <i class='bx bx-x-circle'></i> Hủy đơn
                                </button>
                                <button id="makeReadyShipBtn" class="btn-shopee" onclick="turnOnSearch()">
                                    <i class='bx bx-package'></i> Giao cho vận chuyển
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Search Shipper Box (Hidden by default) -->
                    <div class="shopee-card" id="searchBox" style="display: none;">
                        <div class="search-box">
                            <h4 class="section-title">
                                <i class='bx bx-search'></i> Tìm kiếm Shipper
                            </h4>
                            
                            <div class="search-input-group">
                                <input type="text" id="searchInput" placeholder="Nhập tên shipper..." />
                                <button id="searchButton" class="btn-shopee">
                                    <i class='bx bx-search'></i> Tìm kiếm
                                </button>
                            </div>
                            
                            <table class="table-shopee" id="resultSearch">
                                <thead>
                                    <tr>
                                        <th>Mã</th>
                                        <th>Tên</th>
                                        <th style="text-align: center;">Hành động</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Results will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Products Card -->
                    <div class="shopee-card">
                        <div class="card-padding" style="padding-bottom: 0;">
                            <h3 class="section-title">
                                <i class='bx bx-shopping-bag'></i> Sản phẩm (<span id="productCount">0</span>)
                            </h3>
                        </div>
                        <div class="product-list" id="productList">
                            <!-- Products will be loaded here via AJAX -->
                        </div>
                    </div>
                    
                    <!-- Shipping Info Card -->
                    <div class="shopee-card">
                        <div class="card-padding">
                            <h3 class="section-title">
                                <i class='bx bx-package'></i> Thông tin vận chuyển
                            </h3>
                            
                            <!-- Shipper Info (shown when shipper assigned) -->
                            <div id="shipperInfoBox" style="display: none;">
                                <div class="shipper-box">
                                    <div class="shipper-header">
                                        <div class="shipper-icon-circle">
                                            <i class='bx bx-user'></i>
                                        </div>
                                        <div>
                                            <p class="shipper-name" id="shipperName">...</p>
                                            <p class="shipper-id">Mã: <span id="shipperId">...</span></p>
                                        </div>
                                    </div>
                                    
                                    <div class="shipper-info-grid">
                                        <div class="shipper-info-item">
                                            <div class="shipper-info-label"><i class='bx bx-phone'></i> Số điện thoại</div>
                                            <div class="shipper-info-value" id="shipperPhone">...</div>
                                        </div>
                                        <div class="shipper-info-item">
                                            <div class="shipper-info-label"><i class='bx bx-envelope'></i> Email</div>
                                            <div class="shipper-info-value" id="shipperEmail">...</div>
                                        </div>
                                        <div class="shipper-info-item">
                                            <div class="shipper-info-label"><i class='bx bx-map'></i> Địa chỉ</div>
                                            <div class="shipper-info-value" id="shipperAddress">...</div>
                                        </div>
                                        <div class="shipper-info-item">
                                            <div class="shipper-info-label"><i class='bx bx-time-five'></i> Ngày giao</div>
                                            <div class="shipper-info-value" id="shipmentDate">...</div>
                                        </div>
                                    </div>
                                    
                                    <div id="shipperNoteSection" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid #dee2e6;">
                                        <div class="shipper-info-label"><i class='bx bx-note'></i> Ghi chú</div>
                                        <div class="shipper-info-value" id="shipperNote" style="margin-top: 8px; padding: 8px; background: white; border-radius: 4px;">...</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Need Shipper (shown when no shipper assigned) -->
                            <div id="needShipperBox" class="need-shipper-box">
                                <i class='bx bx-error-circle need-shipper-icon'></i>
                                <p class="need-shipper-text">Đơn hàng này chưa có shipper</p>
                                <p style="font-size: 12px; color: #999; margin: 8px 0 0 0;">Vui lòng giao đơn hàng cho shipper để bắt đầu vận chuyển</p>
                            </div>
                        </div>
                    </div>
                    
                </div>
                <!-- End Main Content -->
                
                <!-- ========== SIDEBAR (RIGHT) ========== -->
                <div class="sidebar">
                
                    <!-- Payment Summary Card (Sticky) - Shopee Style -->
                    <div class="shopee-card">
                        <div class="card-padding">
                            <!-- Total Header (Collapsible) -->
                            <div class="payment-summary-header" onclick="togglePaymentDetails()">
                                <span class="payment-label">Thành tiền:</span>
                                <div class="payment-total">
                                    <span class="payment-value" id="total">0đ</span>
                                    <i class='bx bx-chevron-down payment-collapse-icon' id="paymentChevron"></i>
                                </div>
                            </div>
                            
                            <!-- Payment Details (Collapsible) -->
                            <div class="payment-details" id="paymentDetails">
                                <!-- Tổng tiền hàng -->
                                <div class="payment-row">
                                    <span class="payment-label">Tổng tiền hàng</span>
                                    <span class="payment-value highlight" id="subtotal">0đ</span>
                                </div>
                                
                                <!-- Phí vận chuyển -->
                                <div class="payment-row">
                                    <span class="payment-label">Phí vận chuyển</span>
                                    <span class="payment-value" id="shippingFee">0đ</span>
                                </div>
                                
                                <!-- Ưu đãi phí vận chuyển -->
                                <div class="payment-row" style="display: none;">
                                    <span class="payment-label">
                                        Ưu đãi phí vận chuyển
                                        <i class='bx bx-info-circle info-icon' title="Miễn phí vận chuyển cho đơn > 300k"></i>
                                    </span>
                                    <span class="payment-value discount" id="shippingDiscount">0đ</span>
                                </div>
                                
                                <!-- Voucher giảm giá -->
                                <div class="payment-row" style="display: none;">
                                    <span class="payment-label">Voucher giảm giá</span>
                                    <span class="payment-value discount" id="voucherDiscount">0đ</span>
                                </div>
                                
                                <!-- Divider -->
                                <div class="payment-divider"></div>
                                
                                <!-- Điểm tích lũy -->
                                <div class="payment-points" style="display: none;">
                                    <div class="payment-row">
                                        <span class="payment-label">
                                            <i class='bx bx-gift'></i> Điểm tích lũy
                                        </span>
                                        <span class="payment-value" id="pointsEarned">0 điểm</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customer Info Card -->
                    <div class="shopee-card">
                        <div class="card-padding">
                            <h3 class="section-title">
                                <i class='bx bx-user'></i> Thông tin khách hàng
                            </h3>
                            
                            <div class="customer-info">
                                <img src="/assets/images/users/avatar-1.jpg" alt="Customer" class="customer-avatar" id="customerAvatar">
                                <div>
                                    <p class="customer-name" id="customerName">...</p>
                                    <p class="customer-meta"><i class='bx bx-phone'></i> <span id="customerPhone">...</span></p>
                                </div>
                            </div>
                            
                            <div class="address-box">
                                <p class="address-text">
                                    <i class='bx bx-map' style="color: #ee4d2d;"></i>
                                    <strong>Địa chỉ giao hàng:</strong><br>
                                    <span id="customerAddress">...</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                </div>
                <!-- End Sidebar -->
                
            </div>
            <!-- End 2-Column Layout -->
            
        </div>
        <!-- End Container -->
    </div>
    <!-- End Page Content -->

    <!-- Order cancel fragment -->
    <div th:insert="~{fragments/order/order_cancel.html}"></div>

</div>
<!-- END Wrapper -->

<!-- Vendor Javascript -->
<script src="/assets/js/vendor.js"></script>
<script src="/assets/js/app.js"></script>

<!-- Shopee Admin Order Detail JS -->
<script src="/js/admin-order-detail-shopee.js"></script>

</body>
</html>
