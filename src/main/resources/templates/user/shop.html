<!doctype html>
<html class="no-js" lang="" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title> Shop || James </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- favicon
    ============================================ -->
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">

    <!-- Google Fonts
    ============================================ -->
    <link href='https://fonts.googleapis.com/css?family=Norican' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
    <!-- Bootstrap CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Bootstrap CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <!-- owl.carousel CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.css">
    <link rel="stylesheet" href="/css/owl.transitions.css">
    <!-- jquery-ui CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <!-- meanmenu CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/meanmenu.min.css">
    <!-- nivoslider CSS
    ============================================ -->
    <link rel="stylesheet" href="/lib/css/nivo-slider.css">
    <link rel="stylesheet" href="/lib/css/preview.css">
    <!-- animate CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- magic CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/magic.css">
    <!-- normalize CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/normalize.css">
    <!-- main CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- style CSS
    ============================================ -->
    <link rel="stylesheet" href="/style.css">
    <!-- responsive CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/responsive.css">
    <!-- modernizr JS
    ============================================ -->
    <script src="/js/vendor/modernizr-2.8.3.min.js"></script>
    <style>
        .fa-heart {
            color: red; /* Trái tim đỏ khi yêu thích */
        }

        .fa-heart-o {
            color: #ccc; /* Trái tim xám khi chưa yêu thích */
        }
    </style>
</head>
<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->
<!-- header area start -->
<div th:include="~{fragments/user/header.html}"></div>
<!-- header area end -->
<!-- product items banner start -->
<div class="product-banner">
    <img src="/img/product/banner.jpg" alt="">
</div>
<!-- product items banner end -->
<!-- product main items area start -->
<div class="product-main-items">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="location">
                    <ul>
                        <li><a href="/" title="go to homepage">Home<span>/</span></a></li>
                        <li><strong> shop</strong></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3">
                <div class="product-sidebar">
                    <div class="sidebar-title">
                        <h2>Shopping Options</h2>
                    </div>
                    <div class="single-sidebar">
                        <div class="single-sidebar-title">
                            <h3>Category</h3>
                        </div>
                        <div class="single-sidebar-content">
                            <ul id="categoryList">
                                <li><a href="#" class="category-link active" data-category-id="all">All Products</a></li>
                                <!-- Categories will be loaded dynamically -->
                            </ul>
                        </div>
                    </div>
                    <div class="single-sidebar price">
<!--                        <div class="single-sidebar-title">-->
<!--                            <h3>Price</h3>-->
<!--                        </div>-->
                        <div class="single-sidebar-content">
<!--                            <div class="price-range">-->
<!--                                <div class="price-filter">-->
<!--                                    <div id="slider-range"></div>-->
<!--                                    <div class="price-slider-amount">-->
<!--                                        <input type="text" id="amount" name="price" placeholder="Add Your Price"/>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
                            <form id="searchForm">
                                <input type="hidden" name="category" id="selectedCategory" value="all">
                                <input type="text" name="key" id="searchInput" value="" placeholder="Search products">
                                <button type="button" id="searchBtn"><span>search</span></button>
                            </form>
                        </div>
                    </div>
                    <div class="banner-left">
                        <a href="#">
                            <img src="/img/product/banner_left.jpg" alt="">
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="product-bar">
                    <ul class="nav product-navigation justify-content-center" role="tablist">
                        <li role="presentation" class="gird">
                            <a class="active" href="#gird" aria-controls="gird" role="tab" data-bs-toggle="tab">
                                        <span>
                                            <img class="primary" src="/img/product/grid-primary.png" alt="">
                                            <img class="secondary" src="/img/product/grid-secondary.png" alt="">
                                        </span>
                                Gird
                            </a>
                        </li>
                    </ul>
                    <!--
                    <div class="sort-by">
                        <label>Sort By</label>
                        <select name="sort">
                            <option value="#" selected >Position</option>
                            <option value="#">Name</option>
                            <option value="#">Price</option>
                        </select>
                        <a href="#" title="Set Descending Direction">
                            <img src="/img/product/i_asc_arrow.gif" alt="">
                        </a>
                    </div>-->
                    <div class="time-display limit-product">
                        <label>Current Time</label>
                        <span id="current-time">Loading...</span>
                    </div>
                </div>
                <div class="row" id="tab15">
                    <div class="product-content">
                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active fade show home2" id="gird">
                                <div id="productListContainer">
                                    <div class="row" id="productList">
                                        <!-- Products will be loaded dynamically via AJAX -->
                                        <div class="col-12 text-center" id="loadingSpinner">
                                            <p>Loading products...</p>
                                        </div>
                                    </div>
                                    <!-- Pagination -->
                                    <div id="paginationContainer" class="col-12">
                                        <ul class="pagination justify-content-center" style="margin-top: 50px" id="pagination">
                                            <!-- Pagination will be loaded dynamically -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- product main items area end -->

<!-- footer area start -->
<div th:include="~{fragments/web/footer.html}"></div>
<!-- footer area end -->
<!-- quickview product start -->
<div id="quickview-wrapper">
    <!-- Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="modal-product">
                        <div class="product-images">
                            <div class="main-image images">
                                <img alt="" src="/img/product/quick-view.jpg">
                            </div>
                        </div>

                        <div class="product-info">
                            <h1>Diam quis cursus</h1>
                            <div class="price-box">
                                <p class="price"><span class="special-price"><span class="amount">$132.00</span></span>
                                </p>
                            </div>
                            <a href="shop.html" class="see-all">See all features</a>
                            <div class="quick-add-to-cart">
                                <form method="post" class="cart">
                                    <div class="numbers-row">
                                        <input type="number" id="french-hens" value="3">
                                    </div>
                                    <button class="single_add_to_cart_button" type="submit">Add to cart</button>
                                </form>
                            </div>
                            <div class="quick-desc">
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam fringilla augue nec est
                                    tristique auctor. Donec non est at libero vulputate rutrum. Morbi ornare lectus quis
                                    justo gravida semper. Nulla tellus mi, vulputate adipiscing cursus eu, suscipit id
                                    nulla.</p>
                            </div>
                            <div class="share-post">
                                <div class="share-title">
                                    <h3>share this product</h3>
                                </div>
                                <div class="share-social">
                                    <ul>
                                        <li><a href="#"> <i class="fa fa-facebook"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-twitter"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-pinterest"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-google-plus"></i> </a></li>
                                        <li><a href="#"> <i class="fa fa-linkedin"></i> </a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- quickview product start -->
<!-- jquery
============================================ -->
<script src="/js/vendor/jquery-1.12.4.min.js"></script>
<!-- bootstrap JS
============================================ -->
<script src="/js/bootstrap.min.js"></script>
<!-- wow JS
============================================ -->
<script src="/js/wow.min.js"></script>
<!-- price-slider JS
============================================ -->
<script src="/js/jquery-price-slider.js"></script>
<!-- nivoslider JS
============================================ -->
<script src="/lib/js/jquery.nivo.slider.js"></script>
<script src="/lib/home.js"></script>
<!-- meanmenu JS
============================================ -->
<script src="/js/jquery.meanmenu.js"></script>
<!-- owl.carousel JS
============================================ -->
<script src="/js/owl.carousel.min.js"></script>
<!-- elevatezoom JS
============================================ -->
<script src="/js/jquery.elevatezoom.js"></script>
<!-- scrollUp JS
============================================ -->
<script src="/js/jquery.scrollUp.min.js"></script>
<!-- plugins JS
============================================ -->
<script src="/js/plugins.js"></script>
<!-- main JS
============================================ -->
<script src="/js/main.js"></script>
<script>
    // Global variables
    let currentPage = 0;
    let currentCategory = 'all';
    let searchKeyword = '';

    $(document).ready(function () {
        // Load categories on page load
        loadCategories();
        
        // Load products on page load
        loadProducts(currentPage);

        // Category click handler
        $(document).on('click', '.category-link', function (e) {
            e.preventDefault();
            $('.category-link').removeClass('active');
            $(this).addClass('active');
            
            currentCategory = $(this).data('category-id');
            $('#selectedCategory').val(currentCategory);
            currentPage = 0;
            loadProducts(currentPage);
        });

        // Search button click handler
        $('#searchBtn').click(function (e) {
            e.preventDefault();
            searchKeyword = $('#searchInput').val();
            currentPage = 0;
            loadProducts(currentPage);
        });

        // Search on Enter key
        $('#searchInput').keypress(function (e) {
            if (e.which === 13) {
                e.preventDefault();
                searchKeyword = $(this).val();
                currentPage = 0;
                loadProducts(currentPage);
            }
        });

        // Pagination click handler
        $(document).on('click', '.page-link', function (e) {
            e.preventDefault();
            if (!$(this).parent().hasClass('disabled')) {
                currentPage = $(this).data('page');
                loadProducts(currentPage);
            }
        });

        // Bắt sự kiện khi nhấn vào liên kết "add-to-wishlist"
        $(document).on('click', '.add-to-wishlist', function (e) {
            e.preventDefault();

            var productIdStr = $(this).data('product-id');
            var productId = parseInt(productIdStr, 10);
            if (isNaN(productId) || productId <= 0) {
                alert('ID sản phẩm không hợp lệ');
                return;
            }

            var heartIcon = $(this).find('i');

            $.ajax({
                url: '/wishlist/toggle',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({productId: productId}),
                success: function (response) {
                    if (response === 'ADDED') {
                        heartIcon.removeClass('fa-heart-o').addClass('fa-heart');
                        heartIcon.css('color', 'red');
                    } else if (response === 'REMOVED') {
                        heartIcon.removeClass('fa-heart').addClass('fa-heart-o');
                        heartIcon.css('color', '');
                    } else if (response === 'LOGIN_REQUIRED') {
                        alert('Vui lòng đăng nhập để thêm sản phẩm vào wishlist');
                    } else if (response === 'ALREADY_EXISTS') {
                        alert('Sản phẩm đã có trong wishlist');
                    }
                },
                error: function () {
                    alert('Đã có lỗi xảy ra, vui lòng thử lại sau');
                }
            });
        });
    });

    // Function to load categories via AJAX
    function loadCategories() {
        $.ajax({
            url: '/api/shop/categories',
            type: 'GET',
            dataType: 'json',
            success: function (categories) {
                if (categories && Array.isArray(categories)) {
                    renderCategories(categories);
                } else {
                    console.error('Failed to load categories');
                }
            },
            error: function (xhr, status, error) {
                console.error('Error loading categories:', error);
                $('#categoryList').html('<li>Error loading categories</li>');
            }
        });
    }

    // Function to render categories
    function renderCategories(categories) {
        let categoryHtml = '<li><a href="#" class="category-link active" data-category-id="all">All Products</a></li>';
        
        if (categories && categories.length > 0) {
            categories.forEach(function (category) {
                categoryHtml += '<li><a href="#" class="category-link" data-category-id="' + category.id + '">' +
                    '<span>' + category.name + '</span>' +
                    (category.productCount ? ' (' + category.productCount + ')' : '') +
                    '</a></li>';
            });
        } else {
            categoryHtml += '<li>Chưa có danh mục</li>';
        }
        
        $('#categoryList').html(categoryHtml);
    }

    // Function to load products via AJAX
    function loadProducts(page) {
        $('#loadingSpinner').show();
        $('#productList').html('<div class="col-12 text-center"><p>Loading products...</p></div>');
        
        let url = '/api/shop/products';
        let params = {
            page: page,
            size: 6
        };

        if (currentCategory !== 'all') {
            url = '/api/shop/products/category/' + currentCategory;
        }

        if (searchKeyword && searchKeyword.trim() !== '') {
            params.search = searchKeyword.trim();
        }

        $.ajax({
            url: url,
            type: 'GET',
            data: params,
            dataType: 'json',
            success: function (response) {
                $('#loadingSpinner').hide();
                if (response && response.content) {
                    renderProducts(response.content);
                    renderPagination(response);
                } else {
                    $('#productList').html('<div class="col-12 text-center"><p>No products found</p></div>');
                }
            },
            error: function (xhr, status, error) {
                $('#loadingSpinner').hide();
                console.error('Error loading products:', error);
                $('#productList').html('<div class="col-12 text-center"><p>Error loading products. Please try again.</p></div>');
            }
        });
    }

    // Function to render products
    function renderProducts(products) {
        let productHtml = '';
        
        if (products && products.length > 0) {
            products.forEach(function (product) {
                let formattedPrice = new Intl.NumberFormat().format(product.price);
                productHtml += '<div class="col-lg-4 col-md-6">' +
                    '<div class="single-product">' +
                    '<div class="level-pro-new"><span>new</span></div>' +
                    '<div class="product-img">' +
                    '<a href="/product/details/' + product.id + '">' +
                    '<img src="' + (product.image || '/img/logo.png') + '" alt="' + product.title + '" class="primary-img">' +
                    '<img src="/img/logo.png" alt="Image2" class="secondary-img">' +
                    '</a>' +
                    '</div>' +
                    '<div class="product-name">' +
                    '<a href="/product/details/' + product.id + '" title="' + product.title + '">' + product.title + '</a>' +
                    '</div>' +
                    '<div class="price-rating">' +
                    '<span class="formatted-price">' + formattedPrice + '</span>' +
                    '<div class="ratings">' +
                    '<i class="fa fa-star"></i>' +
                    '<i class="fa fa-star"></i>' +
                    '<i class="fa fa-star"></i>' +
                    '<i class="fa fa-star"></i>' +
                    '<i class="fa fa-star"></i>' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
            });
        } else {
            productHtml = '<div class="col-12 text-center"><h4>No products found</h4></div>';
        }
        
        $('#productList').html(productHtml);
    }

    // Function to render pagination
    function renderPagination(data) {
        let paginationHtml = '';
        
        if (data.totalPages > 0) {
            let currentPageNum = data.currentPage || 0;
            
            // Previous button
            paginationHtml += '<li class="page-item' + (currentPageNum === 0 ? ' disabled' : '') + '">' +
                '<a class="page-link" href="#" data-page="' + (currentPageNum - 1) + '">Previous</a>' +
                '</li>';
            
            // Page numbers
            for (let i = 0; i < data.totalPages; i++) {
                paginationHtml += '<li class="page-item' + (i === currentPageNum ? ' active' : '') + '">' +
                    '<a class="page-link" href="#" data-page="' + i + '">' + (i + 1) + '</a>' +
                    '</li>';
            }
            
            // Next button
            paginationHtml += '<li class="page-item' + (currentPageNum === data.totalPages - 1 ? ' disabled' : '') + '">' +
                '<a class="page-link" href="#" data-page="' + (currentPageNum + 1) + '">Next</a>' +
                '</li>';
        }
        
        $('#pagination').html(paginationHtml);
    }
</script>
<script>
    // Hàm để cập nhật thời gian
    function updateTime() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const timeString = `${hours}:${minutes}:${seconds}`;

        // Cập nhật thời gian hiển thị trong trang
        document.getElementById('current-time').textContent = timeString;
    }

    // Cập nhật thời gian mỗi giây
    setInterval(updateTime, 1000);

    // Cập nhật thời gian ngay khi trang được tải
    updateTime();
</script>

<script>
    document.querySelectorAll('.formatted-price').forEach(function (priceElement) {
        var price = parseFloat(priceElement.textContent);
        priceElement.textContent = new Intl.NumberFormat().format(price);
    });
</script>
</body>
</html>
