<!doctype html>
<html class="no-js" lang="">

<head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Tài Khoản || DeeG Shop </title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

        <!-- favicon
        ============================================ -->
        <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">

        <!-- Google Fonts
        ============================================ -->
        <link href='https://fonts.googleapis.com/css?family=Norican' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- Bootstrap CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <!-- Bootstrap CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <!-- owl.carousel CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/owl.carousel.css">
        <link rel="stylesheet" href="/css/owl.theme.css">
        <link rel="stylesheet" href="/css/owl.transitions.css">
        <!-- jquery-ui CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/jquery-ui.css">
        <!-- meanmenu CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/meanmenu.min.css">
        <!-- nivoslider CSS
        ============================================ -->
        <link rel="stylesheet" href="/lib/css/nivo-slider.css">
        <link rel="stylesheet" href="/lib/css/preview.css">
        <!-- animate CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/animate.css">
        <!-- magic CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/magic.css">
        <!-- normalize CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/normalize.css">
        <!-- main CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/main.css">
        <!-- style CSS
        ============================================ -->
        <link rel="stylesheet" href="/style.css">
        <!-- responsive CSS
        ============================================ -->
        <link rel="stylesheet" href="/css/responsive.css">
        
        <!-- Goong Maps CSS & JS -->
        <link href="https://cdn.jsdelivr.net/npm/@goongmaps/goong-js@1.0.9/dist/goong-js.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/@goongmaps/goong-js@1.0.9/dist/goong-js.js"></script>
        
        
        <!-- modernizr JS
        ============================================ -->
        <script src="/js/vendor/modernizr-2.8.3.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- header area start -->
        <div th:include="~{fragments/user/header.html}"></div>
        <!-- header area end -->
        
        <!-- Breadcrumb Area -->
        <div class="breadcrumb-area" style="background: #fff; padding: 15px 0; margin-bottom: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
            <div class="container">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <a href="javascript:history.back()" style="color: #ee4d2d; font-size: 18px; text-decoration: none;" title="Quay lại">
                        <i class="fa fa-arrow-left"></i>
                    </a>
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <a href="/" class="breadcrumb-link" style="color: #666; text-decoration: none;">Trang chủ</a>
                        <span style="color: #ccc;">/</span>
                        <span style="color: #333; font-weight: 500;">Tài Khoản</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- my account area start -->
        <div class="account-area">
            <div class="container">
                <div class="row" style="display: flex; justify-content: center; align-items: center;" >
                    <div class="col-lg-9">
                        <div class="my-account-accordion">
                            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
<!--                                <div class="panel panel-default">-->
<!--                                    <div class="panel-heading" role="tab" id="headingOne">-->
<!--                                        <h4 class="panel-title">-->
<!--                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">-->
<!--                                                <i class="fa fa-list-ol"></i>-->
<!--                                                Lịch sử và chi tiết đơn hàng-->
<!--                                            </a>-->
<!--                                        </h4>-->
<!--                                    </div>-->
<!--                                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne" data-bs-parent="#accordion">-->
<!--                                        <div class="panel-body">-->
<!--                                            <div class="row">-->
<!--                                                <div class="col-sm-12">-->
<!--                                                    <div class="account-title">-->
<!--                                                        <h4>Đây là các đơn hàng bạn đã đặt kể từ khi tạo tài khoản.</h4>-->
<!--                                                    </div>-->
<!--                                                    <div class="order-history">-->
<!--                                                        <p>Bạn chưa đặt bất kỳ đơn hàng nào.</p>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="panel panel-default">-->
<!--                                    <div class="panel-heading" role="tab" id="headingTwo">-->
<!--                                        <h4 class="panel-title">-->

<!--                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">-->
<!--                                                <i class="fa fa-file-o"></i>-->
<!--                                                Phiếu tín dụng của tôi-->
<!--                                            </a>-->
<!--                                        </h4>-->
<!--                                    </div>-->
<!--                                    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo" data-bs-parent="#accordion">-->
<!--                                        <div class="panel-body">-->
<!--                                            <div class="row">-->
<!--                                                <div class="col-sm-12">-->
<!--                                                    <div class="account-title">-->
<!--                                                        <h4>Các phiếu tín dụng bạn nhận được sau khi hủy đơn hàng. </h4>-->
<!--                                                    </div>-->
<!--                                                    <div class="credit-slids">-->
<!--                                                        <p>Bạn chưa nhận được phiếu tín dụng nào.</p>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
                                
                                <!-- ========== PANEL DEEG XU ========== -->
                                <div class="panel panel-default" style="margin-top: 15px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                                    <div class="panel-heading" role="tab" id="headingCoins" style="background: #f5f5f5; border-bottom: 1px solid #ddd;">
                                        <h4 class="panel-title">
                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseCoins" aria-expanded="false" aria-controls="collapseCoins">
                                                <i class="fa fa-credit-card"></i>
                                                DeeG Xu Của Tôi
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseCoins" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingCoins" data-bs-parent="#accordion">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="my-coins">
                                                        <!-- Description -->
                                                        <div style="background: #fffaf5; border-left: 3px solid #ee4d2d; padding: 12px 16px; margin-bottom: 20px; border-radius: 4px;">
                                                            <p style="margin: 0; font-size: 14px; color: #666; line-height: 1.6;">
                                                                <i class="fa fa-info-circle" style="color: #ee4d2d; margin-right: 6px;"></i>
                                                                Dùng xu để giảm giá khi mua hàng. Xu được hoàn lại khi bạn trả hàng.
                                                            </p>
                                                        </div>
                                                        
                                                        <!-- Coins Balance Container -->
                                                        <div style="background: white; border: 1px solid #efefef; border-radius: 6px; padding: 20px; margin-bottom: 20px;">
                                                            <!-- Balance Display -->
                                                            <div style="display: flex; align-items: center; justify-content: space-between; padding-bottom: 20px; border-bottom: 1px solid #f0f0f0; margin-bottom: 20px;">
                                                                <div>
                                                                    <div style="font-size: 13px; color: #999; margin-bottom: 8px;">
                                                                        <i class="fa fa-credit-card" style="margin-right: 6px;"></i>
                                                                        Số dư DeeG Xu
                                                                    </div>
                                                                    <div style="font-size: 32px; font-weight: 700; color: #ee4d2d;">
                                                                        <span th:text="${#numbers.formatDecimal(walletBalance, 0, 'COMMA', 0, 'POINT')}">0</span> <span style="font-size: 16px; font-weight: 500; color: #999;">xu</span>
                                                                    </div>
                                                                    <div style="font-size: 12px; color: #999; margin-top: 4px;">
                                                                        1 xu = 1 đồng
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Quick Stats Grid -->
                                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                                                <!-- Xu đã dùng -->
                                                                <div style="text-align: center; padding: 16px; background: #fff8f8; border-radius: 6px;">
                                                                    <div style="font-size: 13px; color: #999; margin-bottom: 8px;">Xu đã dùng</div>
                                                                    <div style="font-size: 24px; font-weight: 600; color: #dc3545;" th:text="${#numbers.formatDecimal(totalSpent, 0, 'COMMA', 0, 'POINT')}">0</div>
                                                                </div>
                                                                
                                                                <!-- Xu nhận được -->
                                                                <div style="text-align: center; padding: 16px; background: #f0f9f4; border-radius: 6px;">
                                                                    <div style="font-size: 13px; color: #999; margin-bottom: 8px;">Xu nhận được</div>
                                                                    <div style="font-size: 24px; font-weight: 600; color: #28a745;" th:text="${#numbers.formatDecimal(totalEarned, 0, 'COMMA', 0, 'POINT')}">0</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Transaction History Section (Collapsible) -->
                                                        <div style="background: white; border: 1px solid #efefef; border-radius: 6px; overflow: hidden;">
                                                            <!-- Header (Always Visible) -->
                                                            <div id="transactionHistoryHeader" 
                                                                 style="padding: 16px 20px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; background: #fafafa; border-bottom: 1px solid #efefef;"
                                                                 onclick="toggleTransactionHistory()">
                                                                <div style="font-size: 15px; font-weight: 600; color: #333;">
                                                                    <i class="fa fa-history" style="margin-right: 8px; color: #ee4d2d;"></i>
                                                                    Lịch sử giao dịch
                                                                </div>
                                                                <div>
                                                                    <span style="font-size: 12px; color: #999; margin-right: 10px;">
                                                                        <span th:text="${coinTransactions.size()}">0</span> giao dịch gần nhất
                                                                    </span>
                                                                    <i id="transactionToggleIcon" class="fa fa-angle-down" style="color: #999; font-size: 18px; transition: transform 0.3s;"></i>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Transaction List (Collapsible Content) -->
                                                            <div id="transactionHistoryContent" style="display: none;">
                                                                <div style="padding: 10px;">
                                                                    <!-- Empty State -->
                                                                    <div th:if="${coinTransactions.isEmpty()}" style="text-align: center; padding: 40px; color: #999;">
                                                                        <i class="fa fa-inbox" style="font-size: 48px; color: #ddd; margin-bottom: 16px;"></i>
                                                                        <p style="margin: 0;">Chưa có giao dịch nào</p>
                                                                    </div>
                                                                    
                                                                    <!-- Transaction Items -->
                                                                    <div th:each="tx, iterStat : ${coinTransactions}" 
                                                                         th:style="${iterStat.last ? 'display: flex; align-items: center; padding: 14px; transition: background 0.2s;' : 'display: flex; align-items: center; padding: 14px; border-bottom: 1px solid #f5f5f5; transition: background 0.2s;'}"
                                                                         onmouseover="this.style.background='#fafafa'" onmouseout="this.style.background='transparent'">
                                                                        <!-- Icon -->
                                                                        <div th:style="${tx.transactionType.toString() == 'EARNED' ? 'width: 40px; height: 40px; background: #d4edda; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 14px; flex-shrink: 0;' : 'width: 40px; height: 40px; background: #f8d7da; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 14px; flex-shrink: 0;'}">
                                                                            <i th:class="${tx.transactionType.toString() == 'EARNED' ? 'fa fa-arrow-down' : 'fa fa-arrow-up'}" 
                                                                               th:style="${tx.transactionType.toString() == 'EARNED' ? 'color: #28a745; font-size: 16px;' : 'color: #dc3545; font-size: 16px;'}"></i>
                                                                        </div>
                                                                        <!-- Content -->
                                                                        <div style="flex: 1; min-width: 0;">
                                                                            <div style="font-size: 14px; font-weight: 500; color: #333;" th:text="${tx.description}">
                                                                                Giao dịch
                                                                            </div>
                                                                            <div style="font-size: 12px; color: #999; margin-top: 4px;">
                                                                                <i class="fa fa-clock-o" style="margin-right: 4px;"></i>
                                                                                <span th:text="${#temporals.format(tx.createdDate, 'dd/MM/yyyy HH:mm')}">01/01/2025 00:00</span>
                                                                            </div>
                                                                        </div>
                                                                        <!-- Amount -->
                                                                        <div style="font-size: 18px; font-weight: 600; flex-shrink: 0; margin-left: 14px;"
                                                                             th:style="${tx.transactionType.toString() == 'EARNED' ? 'color: #28a745;' : 'color: #dc3545;'}">
                                                                            <span th:if="${tx.transactionType.toString() == 'EARNED'}">+</span>
                                                                            <span th:if="${tx.transactionType.toString() == 'SPENT'}">-</span>
                                                                            <span th:text="${tx.amount != null ? #numbers.formatDecimal(tx.amount >= 0 ? tx.amount : -tx.amount, 0, 'COMMA', 0, 'POINT') : '0'}">0</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- View All Button -->
                                                                <div style="padding: 16px; text-align: center; background: #fafafa; border-top: 1px solid #efefef;">
                                                                    <a href="#" style="color: #ee4d2d; text-decoration: none; font-size: 14px; font-weight: 500;">
                                                                        Xem tất cả giao dịch <i class="fa fa-angle-right"></i>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ========== PANEL THÀNH VIÊN & ĐIỂM TÍCH LŨY ========== -->
                                <div class="panel panel-default" style="margin-top: 15px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                                    <div class="panel-heading" role="tab" id="headingMembership" style="background: #f5f5f5; border-bottom: 1px solid #ddd;">
                                        <h4 class="panel-title">
                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseMembership" aria-expanded="false" aria-controls="collapseMembership">
                                                <i class="fa fa-star"></i>
                                                Thành Viên & Điểm Tích Lũy
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseMembership" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingMembership" data-bs-parent="#accordion">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="my-membership">
                                                        <!-- Description -->
                                                        <div style="background: #fffaf5; border-left: 3px solid #f39c12; padding: 12px 16px; margin-bottom: 20px; border-radius: 4px;">
                                                            <p style="margin: 0; font-size: 14px; color: #666; line-height: 1.6;">
                                                                <i class="fa fa-info-circle" style="color: #f39c12; margin-right: 6px;"></i>
                                                                Tích điểm từ mỗi đơn hàng và sử dụng để giảm giá cho các đơn hàng tiếp theo.
                                                            </p>
                                                        </div>
                                                        
                                                        <!-- Membership Card Container (Shopee Style) -->
                                                        <div id="membership-card-container" style="border-radius: 8px; padding: 0; margin-bottom: 20px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
                                                            <!-- Loading State -->
                                                            <div id="membership-loading" style="text-align: center; padding: 40px 20px; background: white;">
                                                                <i class="fa fa-spinner fa-spin" style="font-size: 32px; color: #ee4d2d;"></i>
                                                                <p style="margin-top: 15px; font-size: 14px; color: #999;">Đang tải thông tin...</p>
                                                            </div>
                                                            
                                                            <!-- Membership Card (Will be populated by JS) -->
                                                            <div id="membership-card" style="display: none;">
                                                                <!-- Header Section with Tier Background -->
                                                                <div id="tier-header" style="background: linear-gradient(135deg, #757575, #9e9e9e); padding: 24px; color: white; position: relative; overflow: hidden;">
                                                                    <!-- Decorative Pattern -->
                                                                    <div style="position: absolute; right: -20px; top: -20px; width: 150px; height: 150px; border-radius: 50%; background: rgba(255,255,255,0.1);"></div>
                                                                    <div style="position: absolute; right: 40px; bottom: -30px; width: 100px; height: 100px; border-radius: 50%; background: rgba(255,255,255,0.08);"></div>
                                                                    
                                                                    <div style="position: relative; z-index: 1;">
                                                                        <div style="font-size: 32px; font-weight: 700; margin-bottom: 8px; letter-spacing: 2px;">
                                                                            <span id="tier-name">BẠC</span>
                                                                        </div>
                                                                        <div style="font-size: 14px; opacity: 0.9;">
                                                                            <span id="user-fullname" th:text="${session.user?.fullname}">User Name</span>
                                                                        </div>
                                                                        <div style="position: absolute; top: 0; right: 0; text-align: right;">
                                                                            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 4px;">Ưu đãi mỗi thứ hạng</div>
                                                                            <div id="btn-view-benefits" style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; display: inline-block; cursor: pointer; font-size: 13px;">
                                                                                <i class="fa fa-angle-right"></i>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- Main Content View -->
                                                                <div id="main-content-view">
                                                                    <!-- Duy trì thứ hạng thẻ (Shopee Style) -->
                                                                    <div style="background: white; padding: 20px;">
                                                                    <div style="color: #ee4d2d; font-size: 15px; font-weight: 600; margin-bottom: 16px;">
                                                                        Duy trì thứ hạng thẻ
                                                                    </div>
                                                                    
                                                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                                                        <!-- Đơn hàng Progress -->
                                                                        <div style="cursor: pointer;" onclick="window.location.href='/user/order/view'">
                                                                            <div style="font-size: 14px; color: #333; margin-bottom: 8px;">Đơn hàng</div>
                                                                            <div style="font-size: 20px; font-weight: 700; color: #ee4d2d; margin-bottom: 8px;">
                                                                                <span id="order-current">0</span><span style="font-size: 14px; font-weight: 400; color: #666;">/</span><span style="font-size: 16px; font-weight: 600; color: #666;" id="order-target">3</span>
                                                                            </div>
                                                                            <div style="background: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
                                                                                <div id="order-progress-bar" style="background: #ee4d2d; height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <!-- Chi tiêu Progress -->
                                                                        <div>
                                                                            <div style="font-size: 14px; color: #333; margin-bottom: 8px;">Chi tiêu</div>
                                                                            <div style="font-size: 20px; font-weight: 700; color: #ee4d2d; margin-bottom: 8px;">
                                                                                <span id="spending-current">0đ</span><span style="font-size: 14px; font-weight: 400; color: #666;">/</span><span style="font-size: 16px; font-weight: 600; color: #666;" id="spending-target">5.000.000</span>
                                                                            </div>
                                                                            <div style="background: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
                                                                                <div id="spending-progress-bar" style="background: #ee4d2d; height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- Next Tier Info -->
                                                                    <div id="next-tier-info" style="margin-top: 12px; padding: 10px; background: #fff8f5; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                                                                        <div style="font-size: 12px; color: #888;">
                                                                            <span id="progress-text">Chi tiêu thêm 0đ để lên hạng Vàng</span>
                                                                        </div>
                                                                        <a href="/user/order/view" style="font-size: 13px; color: #ee4d2d; text-decoration: none; font-weight: 500;">
                                                                            Chi Tiết <i class="fa fa-angle-right"></i>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- Benefits Section -->
                                                                <div style="padding: 20px; background: #fafafa; border-top: 1px solid #f0f0f0;">
                                                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                                                        <span style="font-size: 14px; color: #333; font-weight: 500;">Quyền lợi thành viên</span>
                                                                        <span style="font-size: 13px; color: #888;">
                                                                            Tỷ lệ tích điểm: <strong style="color: #4caf50;"><span id="earn-rate">1%</span></strong>
                                                                        </span>
                                                                    </div>
                                                                    <div style="font-size: 12px; color: #666; line-height: 1.5;">
                                                                        • Quy đổi: 1 xu = 1 đồng<br>
                                                                        • Nhận xu khi hoàn thành đơn hàng<br>
                                                                        • Sử dụng xu để giảm giá đơn hàng
                                                                    </div>
                                                                </div>
                                                                </div>
                                                                </div>
                                                                <!-- End Main Content View -->
                                                                
                                                                <!-- Benefits View (Shopee Style) -->
                                                                <div id="benefits-view" style="display: none;">
                                                                    
                                                                    <!-- Tabs -->
                                                                    <div style="display: flex; background: white; border-bottom: 2px solid #f0f0f0;">
                                                                        <div class="tier-tab active" data-tier="SILVER" style="flex: 1; text-align: center; padding: 12px; cursor: pointer; font-size: 14px; font-weight: 500; color: #666; border-bottom: 3px solid #757575;">
                                                                            Bạc
                                                                        </div>
                                                                        <div class="tier-tab" data-tier="GOLD" style="flex: 1; text-align: center; padding: 12px; cursor: pointer; font-size: 14px; font-weight: 500; color: #666; border-bottom: 3px solid transparent;">
                                                                            Vàng
                                                                        </div>
                                                                        <div class="tier-tab" data-tier="PLATINUM" style="flex: 1; text-align: center; padding: 12px; cursor: pointer; font-size: 14px; font-weight: 500; color: #666; border-bottom: 3px solid transparent;">
                                                                            Bạch Kim
                                                                        </div>
                                                                        <div class="tier-tab" data-tier="DIAMOND" style="flex: 1; text-align: center; padding: 12px; cursor: pointer; font-size: 14px; font-weight: 500; color: #666; border-bottom: 3px solid transparent;">
                                                                            Kim Cương
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- Tab Content -->
                                                                    <div id="tier-benefits-content" style="background: white; padding: 20px;">
                                                                        <!-- Will be populated by JavaScript -->
                                                                    </div>
                                                                    
                                                                    <!-- Back Button -->
                                                                    <div style="padding: 20px; background: #fafafa; text-align: center; border-top: 1px solid #f0f0f0;">
                                                                        <button id="btn-back-to-main" style="background: white; color: #ee4d2d; border: 1px solid #ee4d2d; padding: 10px 30px; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">
                                                                            <i class="fa fa-arrow-left"></i> Quay lại
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- ========== KẾT THÚC PANEL THÀNH VIÊN ========== -->
                                
                                <div class="panel panel-default" style="margin-top: 15px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                                    <div class="panel-heading" role="tab" id="headingThree" style="background: #f5f5f5; border-bottom: 1px solid #ddd;">
                                        <h4 class="panel-title">
                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                                <i class="fa fa-building-o"></i>
                                                Địa chỉ của tôi
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree" data-bs-parent="#accordion">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="my-address">
                                                        <!-- Error/Success Message -->
                                                        <div id="error-message" class="alert alert-danger" style="display: none; margin-bottom: 20px; border-radius: 6px;">
                                                            <span id="error-text"></span>
                                                        </div>
                                                        
                                                        <!-- Description -->
                                                        <div style="background: #fffaf5; border-left: 3px solid #ee4d2d; padding: 12px 16px; margin-bottom: 20px; border-radius: 4px;">
                                                            <p style="margin: 0; font-size: 14px; color: #666; line-height: 1.6;">
                                                                <i class="fa fa-info-circle" style="color: #ee4d2d; margin-right: 6px;"></i>
                                                                Hãy thiết lập địa chỉ giao hàng để chúng tôi có thể xử lý đơn hàng nhanh chóng hơn.
                                                            </p>
                                                        </div>
                                                        
                                                        <!-- Address List Container -->
                                                        <div style="background: white; border: 1px solid #efefef; border-radius: 6px; padding: 20px; margin-bottom: 20px;">
                                                            <div id="address-list">
                                                                <!-- Address list will be loaded via AJAX -->
                                                                <div style="text-align: center; padding: 20px; color: #999;">
                                                                    <i class="fa fa-spinner fa-spin" style="font-size: 24px;"></i>
                                                                    <p style="margin-top: 10px; font-size: 14px;">Đang tải danh sách địa chỉ...</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Add Address Button -->
                                                        <div style="text-align: center;">
                                                            <button type="button" data-bs-toggle="modal" data-bs-target="#addAddressModal"
                                                                    style="background: white; color: #ee4d2d; border: 1px solid #ee4d2d; padding: 10px 24px; 
                                                                           border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s;"
                                                                    onmouseover="this.style.background='#ee4d2d'; this.style.color='white'" 
                                                                    onmouseout="this.style.background='white'; this.style.color='#ee4d2d'">
                                                                <i class="fa fa-plus-circle"></i> Thêm Địa Chỉ Mới
                                                            </button>
                                                        </div>
                                                        <!-- Modal -->
                                                        <div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog modal-xl" style="max-width: 1200px;">
                                                                <div class="modal-content">
                                                                    <div class="modal-header" style="border-bottom: 1px solid #e5e5e5; padding: 20px 30px; background: #fff;">
                                                                        <h5 class="modal-title" id="addAddressModalLabel" style="font-size: 18px; font-weight: 600; color: #333;">
                                                                            <i class="fa fa-map-marker" style="color: #ee4d2d;"></i> Thêm địa chỉ giao hàng
                                                                        </h5>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="font-size: 20px;"></button>
                                                                    </div>
                                                                    <div class="modal-body" style="padding: 25px 30px; background: #f8f8f8;">
                                                                        <div class="row">
                                                                            <!-- Google Maps Column -->
                                                                            <div class="col-md-7">
                                                                                <div class="map-container" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.08);">
                                                                                    <div style="position: relative; margin-bottom: 12px;">
                                                                                        <i class="fa fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999;"></i>
                                                                                        <input type="text" id="mapSearchInput" placeholder="Tìm kiếm địa chỉ" 
                                                                                           style="width: 100%; padding: 10px 10px 10px 35px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.3s;" 
                                                                                           onfocus="this.style.borderColor='#ee4d2d'" onblur="this.style.borderColor='#e5e5e5'">
                                                                                    </div>
                                                                                    <div id="goongMap" style="width: 100%; height: 420px; border-radius: 6px; overflow: hidden;"></div>
                                                                                    <p style="font-size: 12px; color: #999; margin-top: 8px; margin-bottom: 0;">
                                                                                        <i class="fa fa-info-circle" style="color: #ee4d2d;"></i> Click vào bản đồ để chọn vị trí chính xác
                                                                                    </p>
                                                                                </div>
                                                                            </div>
                                                                            
                                                                            <!-- Form Column -->
                                                                            <div class="col-md-5">
                                                                                <form id="addAddressForm" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.08);">
                                                                                    <!-- Thông tin người nhận -->
                                                                                    <div class="form-group" style="margin-bottom: 18px;">
                                                                                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px;">
                                                                                            <i class="fa fa-user" style="color: #ee4d2d; width: 16px;"></i> Tên người nhận <span style="color: #ee4d2d;">*</span>
                                                                                        </label>
                                                                                        <input type="text" id="recipientName" name="recipientName" placeholder="Nhập họ tên" required
                                                                                               style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.3s;"
                                                                                               onfocus="this.style.borderColor='#ee4d2d'" onblur="this.style.borderColor='#e5e5e5'">
                                                                                    </div>
                                                                                    
                                                                                    <div class="form-group" style="margin-bottom: 18px;">
                                                                                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px;">
                                                                                            <i class="fa fa-phone" style="color: #ee4d2d; width: 16px;"></i> Số điện thoại <span style="color: #ee4d2d;">*</span>
                                                                                        </label>
                                                                                        <input type="tel" id="recipientPhone" name="recipientPhone" placeholder="Nhập số điện thoại" required
                                                                                               pattern="^0\d{9}$" title="Số điện thoại phải là 10 số và bắt đầu bằng 0"
                                                                                               style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.3s;"
                                                                                               onfocus="this.style.borderColor='#ee4d2d'" onblur="this.style.borderColor='#e5e5e5'">
                                                                                    </div>
                                                                                    
                                                                                    <!-- Địa chỉ từ Map -->
                                                                                    <div class="form-group" style="margin-bottom: 18px;">
                                                                                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px;">
                                                                                            <i class="fa fa-map-marker" style="color: #ee4d2d; width: 16px;"></i> Địa chỉ đã chọn <span style="color: #ee4d2d;">*</span>
                                                                                        </label>
                                                                                        <textarea id="selectedAddress" name="selectedAddress" placeholder="Chọn vị trí trên bản đồ" readonly
                                                                                               style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 13px; height: 65px; resize: none; background: #f9f9f9; color: #666;"></textarea>
                                                                                    </div>
                                                                                    
                                                                                    <!-- Hidden fields for coordinates -->
                                                                                    <input type="hidden" id="latitude" name="latitude">
                                                                                    <input type="hidden" id="longitude" name="longitude">
                                                                                    
                                                                                    <!-- Số nhà, tên đường -->
                                                                                    <div class="form-group" style="margin-bottom: 18px;">
                                                                                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px;">
                                                                                            <i class="fa fa-home" style="color: #ee4d2d; width: 16px;"></i> Số nhà, tên đường <span style="color: #ee4d2d;">*</span>
                                                                                        </label>
                                                                                        <textarea id="street" name="street" placeholder="Số nhà, tên đường, phường/xã, quận/huyện" required
                                                                                               style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 14px; height: 70px; resize: none; outline: none; transition: border-color 0.3s;"
                                                                                               onfocus="this.style.borderColor='#ee4d2d'" onblur="this.style.borderColor='#e5e5e5'"></textarea>
                                                                                    </div>
                                                                            
                                                                            <!-- Tỉnh/Thành phố -->
                                                                            <div class="form-group" style="margin-bottom: 18px;">
                                                                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px;">
                                                                                    <i class="fa fa-building-o" style="color: #ee4d2d; width: 16px;"></i> Tỉnh/Thành phố <span style="color: #ee4d2d;">*</span>
                                                                                </label>
                                                                                <input type="text" id="city" name="city" placeholder="Tự động điền từ bản đồ" required readonly
                                                                                       style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 14px; background-color: #f9f9f9; color: #666;">
                                                                            </div>
                                                                            
                                                                            <!-- Hidden: Country mặc định Việt Nam -->
                                                                            <input type="hidden" id="country" name="country" value="Việt Nam">
                                                                            
                                                                            <!-- Loại địa chỉ -->
                                                                            <div class="form-group" style="margin-bottom: 18px;">
                                                                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px;">
                                                                                    <i class="fa fa-tag" style="color: #ee4d2d; width: 16px;"></i> Loại địa chỉ
                                                                                </label>
                                                                                <select id="addressType" name="addressType"
                                                                                        style="width: 100%; padding: 10px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 14px; outline: none; cursor: pointer; background: white;">
                                                                                    <option value="HOME">Nhà riêng</option>
                                                                                    <option value="OFFICE">Văn phòng</option>
                                                                                </select>
                                                                            </div>
                                                                            
                                                                            <!-- Checkbox: Đặt làm địa chỉ mặc định -->
                                                                            <div class="form-group" style="margin-bottom: 0;">
                                                                                <label style="display: flex; align-items: center; cursor: pointer; padding: 12px; background: #fff8f0; border: 1px solid #ffe8cc; border-radius: 6px;">
                                                                                    <input type="checkbox" id="isDefault" name="isDefault" value="true"
                                                                                           style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer; accent-color: #ee4d2d;">
                                                                                    <span style="font-weight: 500; font-size: 14px; color: #333;">
                                                                                        <i class="fa fa-star" style="color: #ee4d2d;"></i> Đặt làm địa chỉ mặc định
                                                                                    </span>
                                                                                </label>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                                <!-- Modal Footer -->
                                                                <div class="modal-footer" style="border-top: 1px solid #e5e5e5; padding: 15px 30px; background: white;">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" 
                                                                            style="padding: 10px 24px; font-size: 14px; border-radius: 6px; border: 1px solid #ddd; background: white; color: #666;">
                                                                        Hủy
                                                                    </button>
                                                                    <button type="submit" form="addAddressForm" 
                                                                            style="padding: 10px 24px; font-size: 14px; border-radius: 6px; background: #ee4d2d; color: white; border: none; font-weight: 500; cursor: pointer;">
                                                                        Lưu Địa Chỉ
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- ========== KẾT THÚC PANEL ĐỊA CHỈ CỦA TÔI ========== -->

<!--                                <div class="panel panel-default" style="margin-top: 15px; background: white; border: 1px solid #ddd; border-radius: 4px;">-->
<!--                                    <div class="panel-heading" role="tab" id="headingFive" style="background: #f5f5f5; border-bottom: 1px solid #ddd;">-->
<!--                                        <h4 class="panel-title">-->
<!--                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">-->
<!--                                                <i class="bi bi-cart"></i>-->
<!--                                                Viewed Products-->
<!--                                            </a>-->
<!--                                        </h4>-->
<!--                                    </div>-->
<!--                                    <div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive" data-bs-parent="#accordion">-->
<!--                                        <div class="panel-body">-->
<!--                                            <div class="col-sm-12">-->
<!--                                                <div class="wishlist-container">-->
<!--                                                    <h3>Viewed Products</h3>-->
<!--                                                    <div id="viewed-products-list">-->
<!--                                                        &lt;!&ndash; Viewed products will be loaded via AJAX &ndash;&gt;-->
<!--                                                        <p>Loading...</p>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
                            </div>
                                <!-- ========== PANEL MY PERSONAL INFORMATION ========== -->
                                <div class="panel panel-default" style="margin-top: 15px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                                    <div class="panel-heading" role="tab" id="headingFour" style="background: #f5f5f5; border-bottom: 1px solid #ddd;">
                                        <h4 class="panel-title">
                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                                <i class="fa fa-user"></i>
                                                Thông Tin Cá Nhân
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour" data-bs-parent="#accordion">
                                        <div class="panel-body">
                                            <div class="col-md-12">
                                                <div class="delivery-details">
                                                    <form id="updateProfileForm" enctype="multipart/form-data">
                                                        <div class="list-style">
                                                            <!-- Avatar Upload Section (Shopee Style) -->
                                                            <div style="background: linear-gradient(135deg, #ee4d2d, #ff6635); padding: 40px 20px; text-align: center; margin: -15px -15px 20px -15px; position: relative;">
                                                                <div style="position: relative; display: inline-block;">
                                                                    <div style="width: 100px; height: 100px; border-radius: 50%; overflow: hidden; border: 4px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.15); background: white; margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                                                                        <img id="profile-avatar-preview" 
                                                                             th:src="${session.user?.profilePicture ?: '/img/avatar-default.svg'}"
                                                                             alt="Avatar" 
                                                                             style="width: 100%; height: 100%; object-fit: cover;"
                                                                             onerror="this.src='/img/avatar-default.svg'">
                                                                    </div>
                                                                    <label for="avatar-upload" style="position: absolute; bottom: 0; right: 0; background: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; border: 2px solid #ee4d2d; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                                                        <i class="fa fa-camera" style="color: #ee4d2d; font-size: 14px;"></i>
                                                                    </label>
                                                                    <input type="file" id="avatar-upload" name="avatar" accept="image/*" style="display: none;" onchange="previewAvatar(event)">
                                                                </div>
                                                                <div style="color: white; margin-top: 12px; font-size: 14px; opacity: 0.9;">
                                                                    Click vào camera để thay đổi ảnh
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="account-title">
                                                                <h4>Vui Lòng Cập Nhật Thông Tin Cá Nhân Nếu Có Thay Đổi</h4>
                                                            </div>

                                                            <!-- Error Message -->
                                                            <div id="profile-error" class="alert alert-danger" style="display: none; font-size: 13px; padding: 10px 15px;">
                                                                <span id="profile-error-text"></span>
                                                            </div>

                                                            <!-- Success Message -->
                                                            <div id="profile-success" class="alert alert-success" style="display: none; font-size: 13px; padding: 10px 15px;">
                                                                <span id="profile-success-text"></span>
                                                            </div>

                                                            <div class="form-name" style="display: flex; align-items: center; margin-bottom: 20px;">
                                                                <label style="width: 200px; min-width: 200px; margin-right: 15px; margin-bottom: 0; white-space: nowrap; font-size: 13px; text-align: right; font-family: inherit; color: #666;">Email</label>
                                                                <input type="email" id="user-email" name="email" placeholder="Email" readonly 
                                                                       th:value="${session.user?.email}"
                                                                       style="flex: 1; font-size: 13px; font-family: inherit; line-height: 1.5; padding: 8px 12px; border: 1px solid #ddd; border-radius: 3px; background-color: #f5f5f5; cursor: not-allowed;">
                                                            </div>

                                                            <div class="form-name" style="display: flex; align-items: center; margin-bottom: 20px;">
                                                                <label style="width: 200px; min-width: 200px; margin-right: 15px; margin-bottom: 0; white-space: nowrap; font-size: 13px; text-align: right; font-family: inherit; color: #666;">Họ Và Tên <em>*</em></label>
                                                                <input type="text" id="user-fullname" name="fullname" placeholder="Nhập họ và tên" required 
                                                                       th:value="${session.user?.fullname}"
                                                                       style="flex: 1; font-size: 13px; font-family: inherit; line-height: 1.5; padding: 8px 12px; border: 1px solid #ddd; border-radius: 3px;">
                                                            </div>

                                                            <div class="form-name" style="display: flex; align-items: center; margin-bottom: 20px;">
                                                                <label style="width: 200px; min-width: 200px; margin-right: 15px; margin-bottom: 0; white-space: nowrap; font-size: 13px; text-align: right; font-family: inherit; color: #666;">Số Điện Thoại</label>
                                                                <input type="text" id="user-phone" name="phone" placeholder="Nhập số điện thoại (10 số)" pattern="^0\d{9}$"
                                                                       th:value="${session.user?.phone}"
                                                                       style="flex: 1; font-size: 13px; font-family: inherit; line-height: 1.5; padding: 8px 12px; border: 1px solid #ddd; border-radius: 3px;">
                                                            </div>

                                                            <div class="save-button">
                                                                <button type="submit">
                                                                    <i class="fa fa-save"></i> Lưu Thay Đổi
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- ========== KẾT THÚC PANEL THÔNG TIN CÁ NHÂN ========== -->
                                <!-- ========== PANEL ĐỔI MẬT KHẨU ========== -->
                                <div class="panel panel-default" style="margin-top: 15px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                                    <div class="panel-heading" role="tab" id="headingResetPassword" style="background: #f5f5f5; border-bottom: 1px solid #ddd;">
                                        <h4 class="panel-title">
                                            <a class="collapsed" role="button" data-bs-toggle="collapse" href="#collapseResetPassword" aria-expanded="false" aria-controls="collapseResetPassword">
                                                <i class="fa fa-lock"></i>
                                                Đổi Mật Khẩu
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapseResetPassword" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingResetPassword" data-bs-parent="#accordion">
                                        <div class="panel-body">
                                            <div class="col-md-12">
                                                <!-- Check if user logged in with Google -->
                                                <div th:if="${session.user?.provider != null and session.user.provider == 'GOOGLE'}">
                                                    <!-- Shopee Style Notice -->
                                                    <div style="text-align: center; padding: 40px 20px;">
                                                        <div style="width: 80px; height: 80px; background: #fff8f5; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center;">
                                                            <i class="fa fa-google" style="font-size: 36px; color: #ee4d2d;"></i>
                                                        </div>
                                                        <h4 style="color: #333; margin-bottom: 12px; font-size: 18px; font-weight: 600;">Tài khoản Google</h4>
                                                        <p style="color: #666; font-size: 14px; line-height: 1.6; max-width: 400px; margin: 0 auto;">
                                                            Bạn đang sử dụng tài khoản Google để đăng nhập.<br>
                                                            Không thể thay đổi mật khẩu cho tài khoản này.
                                                        </p>
                                                        <div style="margin-top: 20px; padding: 12px 20px; background: #fff8f5; border-radius: 6px; display: inline-block;">
                                                            <i class="fa fa-info-circle" style="color: #ee4d2d; margin-right: 6px;"></i>
                                                            <span style="color: #666; font-size: 13px;">Vui lòng quản lý mật khẩu qua tài khoản Google của bạn</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Normal password change form (for LOCAL accounts) -->
                                                <div th:if="${session.user?.provider == null or session.user.provider == 'LOCAL'}" class="delivery-details">
                                                    <form id="changePasswordForm">
                                                        <div class="list-style">
                                                            <div class="account-title">
                                                                <h4>Vui Lòng Nhập Mật Khẩu Hiện Tại Và Mật Khẩu Mới Để Thay Đổi</h4>
                                                            </div>

                                                            <!-- Error Message -->
                                                            <div id="password-error" class="alert alert-danger" style="display: none; font-size: 13px; padding: 10px 15px;">
                                                                <span id="password-error-text"></span>
                                                            </div>

                                                            <!-- Success Message -->
                                                            <div id="password-success" class="alert alert-success" style="display: none; font-size: 13px; padding: 10px 15px;">
                                                                <span id="password-success-text"></span>
                                                            </div>

                                                            <div class="form-name" style="display: flex; align-items: center; margin-bottom: 20px;">
                                                                <label style="width: 200px; min-width: 200px; margin-right: 15px; margin-bottom: 0; white-space: nowrap; font-size: 13px; text-align: right; font-family: inherit; color: #666;">Mật Khẩu Hiện Tại <em>*</em></label>
                                                                <input type="password" name="currentPassword" placeholder="Nhập mật khẩu hiện tại" required minlength="6" style="flex: 1; font-size: 13px; font-family: inherit; line-height: 1.5; padding: 8px 12px; border: 1px solid #ddd; border-radius: 3px;">
                                                            </div>

                                                            <div class="form-name" style="display: flex; align-items: center; margin-bottom: 20px;">
                                                                <label style="width: 200px; min-width: 200px; margin-right: 15px; margin-bottom: 0; white-space: nowrap; font-size: 13px; text-align: right; font-family: inherit; color: #666;">Mật Khẩu Mới <em>*</em></label>
                                                                <input type="password" name="newPassword" placeholder="Nhập mật khẩu mới (tối thiểu 6 ký tự)" required minlength="6" style="flex: 1; font-size: 13px; font-family: inherit; line-height: 1.5; padding: 8px 12px; border: 1px solid #ddd; border-radius: 3px;">
                                                            </div>

                                                            <div class="form-name" style="display: flex; align-items: center; margin-bottom: 20px;">
                                                                <label style="width: 200px; min-width: 200px; margin-right: 15px; margin-bottom: 0; white-space: nowrap; font-size: 13px; text-align: right; font-family: inherit; color: #666;">Xác Nhận Mật Khẩu Mới <em>*</em></label>
                                                                <input type="password" name="confirmPassword" placeholder="Nhập lại mật khẩu mới" required minlength="6" style="flex: 1; font-size: 13px; font-family: inherit; line-height: 1.5; padding: 8px 12px; border: 1px solid #ddd; border-radius: 3px;">
                                                            </div>

                                                            <div class="save-button">
                                                                <button type="submit">
                                                                    <i class="fa fa-save"></i> Lưu Thay Đổi
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- ========== KẾT THÚC PANEL ĐỔI MẬT KHẨU ========== -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- my account area end -->

        <!-- footer area start -->
        <div th:include="~{fragments/web/footer.html}"></div>
        <!-- footer area end -->

        <!-- jquery
        ============================================ -->
        <script src="/js/vendor/jquery-1.12.4.min.js"></script>
        <!-- bootstrap JS
        ============================================ -->
        <script src="/js/bootstrap.min.js"></script>
        <!-- wow JS
        ============================================ -->
        <script src="/js/wow.min.js"></script>
        <!-- price-slider JS
        ============================================ -->
        <script src="/js/jquery-price-slider.js"></script>
        <!-- nivoslider JS
        ============================================ -->
        <script src="/lib/js/jquery.nivo.slider.js"></script>
        <script src="/lib/home.js"></script>
        <!-- meanmenu JS
        ============================================ -->
        <script src="/js/jquery.meanmenu.js"></script>
        <!-- owl.carousel JS
        ============================================ -->
        <script src="/js/owl.carousel.min.js"></script>
        <!-- elevatezoom JS
        ============================================ -->
        <script src="/js/jquery.elevatezoom.js"></script>
        <!-- scrollUp JS
        ============================================ -->
        <script src="/js/jquery.scrollUp.min.js"></script>
        <!-- plugins JS
        ============================================ -->
        <script src="/js/plugins.js"></script>
        <!-- main JS
        ============================================ -->
        <script src="/js/main.js"></script>
        
        <!-- User Account JS -->
        <script src="/js/user/user-account.js"></script>
        
        <!-- Address Manager Script -->
        <script src="/js/user/address-manager.js"></script>
        <script src="/js/user/goong-maps.js"></script>
        
        <!-- Change Password Script (RESTful API + Ajax + jQuery) -->
        <script src="/js/user/user-change-password.js"></script>
        
        <!-- User Profile Script (RESTful API + Ajax + jQuery) -->
        <script src="/js/user/user-profile.js"></script>
        
        <!-- Header Cart Badge JavaScript (Require jQuery) -->
        <script src="/js/header-cart.js?v=3"></script>
        
        <!-- Membership Points Script -->
        <script>
        $(document).ready(function() {
            // Load membership info when Membership panel is opened
            $('#headingMembership a').on('click', function() {
                if (!$(this).hasClass('loaded')) {
                    $(this).addClass('loaded');
                    loadMembershipInfo();
                }
            });
            
            // Auto-load if panel is already expanded
            if ($('#collapseMembership').hasClass('show')) {
                loadMembershipInfo();
            }
            
            // View benefits button click
            $(document).on('click', '#btn-view-benefits', function() {
                $('#main-content-view').fadeOut(300, function() {
                    $('#benefits-view').fadeIn(300);
                    // Load default tier (SILVER)
                    showTierBenefits('SILVER');
                });
            });
            
            // Back button click
            $(document).on('click', '#btn-back-to-main', function() {
                $('#benefits-view').fadeOut(300, function() {
                    $('#main-content-view').fadeIn(300);
                });
            });
            
            // Tier tab click
            $(document).on('click', '.tier-tab', function() {
                const tier = $(this).data('tier');
                
                // Update active tab
                $('.tier-tab').css('border-bottom-color', 'transparent').removeClass('active');
                $(this).addClass('active');
                
                // Update border color based on tier
                const tierColors = {
                    'SILVER': '#757575',
                    'GOLD': '#ffc107',
                    'PLATINUM': '#9c27b0',
                    'DIAMOND': '#212121'
                };
                $(this).css('border-bottom-color', tierColors[tier]);
                
                // Load tier benefits
                showTierBenefits(tier);
            });
        });
        
        function loadMembershipInfo() {
            $.ajax({
                url: '/api/membership/points/balance',
                method: 'GET',
                success: function(response) {
                    if (response && response.points !== undefined) {
                        // Tier colors (Shopee style)
                        const tierColors = {
                            'SILVER': 'linear-gradient(135deg, #757575, #9e9e9e)',
                            'GOLD': 'linear-gradient(135deg, #ffa000, #ffc107)',
                            'PLATINUM': 'linear-gradient(135deg, #9c27b0, #ba68c8)',
                            'DIAMOND': 'linear-gradient(135deg, #212121, #424242)'
                        };
                        
                        const tierName = response.tierDisplayName || 'Bạc';
                        
                        // Update header background color
                        $('#tier-header').css('background', tierColors[response.tier] || tierColors['SILVER']);
                        
                        // Update card content
                        $('#tier-name').text(tierName.toUpperCase());
                        $('#points-display').text(response.points.toLocaleString('vi-VN'));
                        $('#points-value-inline').text(formatCurrency(response.pointsValue || 0));
                        $('#earn-rate').text((response.earnRate || 1) + '%');
                        
                        // Update spending progress
                        const currentSpending = response.totalSpending || 0;
                        $('#spending-current').text(currentSpending.toLocaleString('vi-VN') + 'đ');
                        
                        // Update order progress
                        const orderCount = response.orderCount || 0;
                        updateOrderProgress(response.tier, orderCount);
                        
                        // Calculate tier progress
                        calculateTierProgress(response.tier, currentSpending);
                        
                        // Show card, hide loading
                        $('#membership-loading').hide();
                        $('#membership-card').show();
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Failed to load membership info:', error);
                    $('#membership-loading').html(`
                        <div style="text-align: center; padding: 40px 20px;">
                            <div style="font-size: 48px; margin-bottom: 15px;">⚠️</div>
                            <h4 style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px;">
                                Không thể tải thông tin
                            </h4>
                            <p style="font-size: 14px; color: #999; margin: 0;">
                                Vui lòng thử lại sau.
                            </p>
                        </div>
                    `);
                }
            });
        }
        
        function updateOrderProgress(currentTier, orderCount) {
            // Order requirements per tier
            const orderRequirements = {
                'SILVER': 3,
                'GOLD': 10,
                'PLATINUM': 30,
                'DIAMOND': 100
            };
            
            const targetOrders = orderRequirements[currentTier] || 3;
            const progressPercent = Math.min((orderCount / targetOrders) * 100, 100);
            
            // Update UI
            $('#order-current').text(orderCount);
            $('#order-target').text(targetOrders);
            $('#order-progress-bar').css('width', progressPercent + '%');
        }
        
        function calculateTierProgress(currentTier, totalSpending) {
            // Tier requirements (same as MembershipTier enum)
            const tierRequirements = {
                'SILVER': { next: 'GOLD', nextName: 'Vàng', requirement: 5000000 },
                'GOLD': { next: 'PLATINUM', nextName: 'Bạch Kim', requirement: 20000000 },
                'PLATINUM': { next: 'DIAMOND', nextName: 'Kim Cương', requirement: 50000000 },
                'DIAMOND': { next: null, nextName: null, requirement: null }
            };
            
            const tierInfo = tierRequirements[currentTier];
            
            if (!tierInfo || !tierInfo.next) {
                // Already max tier - hide next tier info
                $('#next-tier-info').html('<div style="font-size: 12px; color: #888;">Bạn đã đạt hạng cao nhất! 🎉</div>');
                $('#spending-target').text('Max');
                $('#spending-progress-bar').css('width', '100%');
                return;
            }
            
            const nextTierRequirement = tierInfo.requirement;
            const currentSpending = totalSpending || 0;
            const remainingAmount = nextTierRequirement - currentSpending;
            
            // Calculate progress percentage
            let progressPercent = 0;
            if (currentTier === 'SILVER') {
                progressPercent = (currentSpending / nextTierRequirement) * 100;
            } else if (currentTier === 'GOLD') {
                const previousTier = 5000000;
                progressPercent = ((currentSpending - previousTier) / (nextTierRequirement - previousTier)) * 100;
            } else if (currentTier === 'PLATINUM') {
                const previousTier = 20000000;
                progressPercent = ((currentSpending - previousTier) / (nextTierRequirement - previousTier)) * 100;
            }
            
            progressPercent = Math.min(Math.max(progressPercent, 0), 100);
            
            // Update UI
            $('#spending-target').text(nextTierRequirement.toLocaleString('vi-VN'));
            $('#spending-progress-bar').css('width', progressPercent + '%');
            
            if (remainingAmount > 0) {
                $('#progress-text').text('Chi tiêu thêm ' + formatCurrency(remainingAmount) + ' để lên hạng ' + tierInfo.nextName);
            } else {
                $('#progress-text').text('Đã đủ điều kiện lên hạng ' + tierInfo.nextName + '!');
            }
        }
        
        function showTierBenefits(tier) {
            const benefits = {
                'SILVER': {
                    color: '#757575',
                    icon: '🥈',
                    requirement: 'Tham gia ngay',
                    items: [
                        { icon: 'fa-truck', title: 'Miễn phí vận chuyển', desc: 'Giảm 5,000đ phí ship' },
                        { icon: 'fa-calendar', title: 'Ngày hội Thành viên', desc: '2 voucher mỗi tháng' },
                        { icon: 'fa-tags', title: 'Sản phẩm giá hạng Bạc', desc: 'Giá ưu đãi dành riêng hạng Bạc' },
                        { icon: 'fa-percent', title: 'Voucher HOT từ Shop', desc: 'Ưu đãi tới 30%' }
                    ]
                },
                'GOLD': {
                    color: '#ffc107',
                    icon: '🥇',
                    requirement: 'Chi tiêu từ 5,000,000đ',
                    items: [
                        { icon: 'fa-truck', title: 'Miễn phí vận chuyển', desc: 'Giảm 15,000đ phí ship' },
                        { icon: 'fa-calendar', title: 'Ngày hội Thành viên', desc: '5 voucher mỗi tháng' },
                        { icon: 'fa-tags', title: 'Sản phẩm giá hạng Vàng', desc: 'Giá ưu đãi dành riêng hạng Vàng' },
                        { icon: 'fa-percent', title: 'Voucher HOT từ Shop', desc: 'Ưu đãi tới 50% từ Shop' },
                        { icon: 'fa-gift', title: 'Quà tặng sinh nhật', desc: 'Voucher đặc biệt ngày sinh nhật' }
                    ]
                },
                'PLATINUM': {
                    color: '#9c27b0',
                    icon: '💎',
                    requirement: 'Chi tiêu từ 20,000,000đ',
                    items: [
                        { icon: 'fa-truck', title: 'Miễn phí vận chuyển', desc: 'Giảm 30,000đ phí ship' },
                        { icon: 'fa-calendar', title: 'Ngày hội Thành viên', desc: '10 voucher mỗi tháng' },
                        { icon: 'fa-tags', title: 'Sản phẩm giá hạng Bạch Kim', desc: 'Giá VIP dành riêng hạng Bạch Kim' },
                        { icon: 'fa-percent', title: 'Voucher HOT từ Shop', desc: 'Ưu đãi tới 70% từ Shop' },
                        { icon: 'fa-gift', title: 'Quà tặng sinh nhật', desc: 'Voucher đặc biệt + Quà tặng' },
                        { icon: 'fa-star', title: 'Ưu tiên hỗ trợ', desc: 'Hỗ trợ khách hàng ưu tiên' }
                    ]
                },
                'DIAMOND': {
                    color: '#212121',
                    icon: '💠',
                    requirement: 'Chi tiêu từ 50,000,000đ',
                    items: [
                        { icon: 'fa-truck', title: 'Miễn phí vận chuyển', desc: 'FREE SHIP toàn bộ đơn hàng' },
                        { icon: 'fa-calendar', title: 'Ngày hội Thành viên', desc: 'Voucher không giới hạn' },
                        { icon: 'fa-tags', title: 'Sản phẩm giá hạng Kim Cương', desc: 'Giá độc quyền - Thấp nhất' },
                        { icon: 'fa-percent', title: 'Voucher HOT từ Shop', desc: 'Ưu đãi lên tới 90% từ Shop' },
                        { icon: 'fa-gift', title: 'Quà tặng cao cấp', desc: 'Quà tặng VIP + Ưu đãi đặc biệt' },
                        { icon: 'fa-star', title: 'Dịch vụ VIP', desc: 'Chăm sóc 1-1, ưu tiên cao nhất' },
                        { icon: 'fa-crown', title: 'Sự kiện độc quyền', desc: 'Tham gia sự kiện dành riêng VIP' }
                    ]
                }
            };
            
            const tierData = benefits[tier];
            const tierNames = {
                'SILVER': 'Bạc',
                'GOLD': 'Vàng', 
                'PLATINUM': 'Bạch Kim',
                'DIAMOND': 'Kim Cương'
            };
            
            let html = `
                <div style="border-left: 4px solid ${tierData.color}; padding-left: 15px; margin-bottom: 20px;">
                    <div style="font-size: 18px; font-weight: 600; color: ${tierData.color}; margin-bottom: 5px;">
                        ${tierData.icon} Thẻ ${tierNames[tier]}
                    </div>
                    <div style="font-size: 13px; color: #666;">
                        ${tierData.requirement}
                    </div>
                </div>
            `;
            
            tierData.items.forEach(item => {
                html += `
                    <div style="display: flex; align-items: flex-start; padding: 15px 0; border-bottom: 1px solid #f5f5f5;">
                        <div style="width: 40px; height: 40px; background: ${tierData.color}15; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fa ${item.icon}" style="color: ${tierData.color}; font-size: 18px;"></i>
                        </div>
                        <div style="margin-left: 15px; flex: 1;">
                            <div style="font-size: 15px; font-weight: 600; color: #333; margin-bottom: 4px;">
                                ${item.title}
                            </div>
                            <div style="font-size: 13px; color: #666;">
                                ${item.desc}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            $('#tier-benefits-content').html(html);
        }
        
        function formatCurrency(amount) {
            if (!amount && amount !== 0) return '0đ';
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }
        
        // Avatar preview and upload function
        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert('Vui lòng chọn file ảnh!');
                    event.target.value = '';
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Kích thước ảnh tối đa 5MB!');
                    event.target.value = '';
                    return;
                }
                
                // Preview image immediately
                const reader = new FileReader();
                reader.onload = function(e) {
                    $('#profile-avatar-preview').attr('src', e.target.result);
                };
                reader.readAsDataURL(file);
                
                // Auto-upload to Cloudinary
                uploadAvatarToCloudinary(file);
            }
        }
        
        // Upload avatar to Cloudinary
        function uploadAvatarToCloudinary(file) {
            const formData = new FormData();
            formData.append('avatar', file);
            
            // Show loading
            showAvatarLoading();
            
            $.ajax({
                url: '/api/user/profile/upload-avatar',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    hideAvatarLoading();
                    
                    if (response.success) {
                        console.log('✅ Avatar uploaded to Cloudinary:', response.avatarUrl);
                        
                        // Show success notification
                        showNotification('success', '✓ Cập nhật ảnh đại diện thành công!');
                        
                        // Update avatar with Cloudinary URL
                        $('#profile-avatar-preview').attr('src', response.avatarUrl);
                        
                        // Reload avatar from API
                        setTimeout(function() {
                            loadUserProfileWithAvatar();
                        }, 500);
                    } else {
                        console.error('❌ Upload failed:', response.message);
                        showNotification('error', '✕ ' + response.message);
                    }
                },
                error: function(xhr) {
                    hideAvatarLoading();
                    console.error('❌ Upload error:', xhr);
                    
                    let errorMsg = 'Có lỗi khi upload ảnh lên cloud. Vui lòng thử lại.';
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        errorMsg = xhr.responseJSON.message;
                    }
                    showNotification('error', '✕ ' + errorMsg);
                }
            });
        }
        
        // Show loading overlay
        function showAvatarLoading() {
            const $avatarContainer = $('#profile-avatar-preview').parent();
            $avatarContainer.append(`
                <div id="avatar-loading-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                    <div style="text-align: center;">
                        <i class="fa fa-spinner fa-spin" style="color: white; font-size: 32px;"></i>
                        <div style="color: white; font-size: 11px; margin-top: 8px;">Uploading...</div>
                    </div>
                </div>
            `);
        }
        
        // Hide loading overlay
        function hideAvatarLoading() {
            $('#avatar-loading-overlay').remove();
        }
        
        // Show notification toast
        function showNotification(type, message) {
            const bgColor = type === 'success' ? '#4caf50' : '#f44336';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            
            const $notification = $(`
                <div style="position: fixed; top: 80px; right: 20px; z-index: 9999; background: ${bgColor}; color: white; padding: 16px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); min-width: 320px; animation: slideInRight 0.3s;">
                    <i class="fa ${icon}" style="margin-right: 10px; font-size: 18px;"></i>
                    <span style="font-size: 14px; font-weight: 500;">${message}</span>
                </div>
            `);
            
            $('body').append($notification);
            
            setTimeout(function() {
                $notification.fadeOut(300, function() {
                    $(this).remove();
                });
            }, 3500);
        }
        
        // Debug avatar loading and load from API
        $(document).ready(function() {
            const avatarSrc = $('#profile-avatar-preview').attr('src');
            console.log('Initial avatar source:', avatarSrc);
            
            // Load user profile with avatar when page loads
            loadUserProfileWithAvatar();
            
            // When profile panel is opened, reload avatar
            $('#collapseFour').on('shown.bs.collapse', function() {
                loadUserProfileWithAvatar();
            });
        });
        
        // Load user profile including avatar
        function loadUserProfileWithAvatar() {
            $.ajax({
                url: '/api/user/profile/avatar',
                type: 'GET',
                success: function(response) {
                    console.log('📦 Full API Response:', response);
                    
                    if (response.success && response.user) {
                        const user = response.user;
                        console.log('👤 User data:', user);
                        console.log('🖼️ Profile picture value:', user.profilePicture);
                        console.log('🖼️ Profile picture type:', typeof user.profilePicture);
                        console.log('🖼️ Profile picture length:', user.profilePicture ? user.profilePicture.length : 0);
                        
                        // Update avatar if available and not empty
                        if (user.profilePicture && user.profilePicture.trim() !== '') {
                            console.log('✅ Updating avatar to:', user.profilePicture);
                            $('#profile-avatar-preview').attr('src', user.profilePicture);
                            
                            // Test if image loads successfully
                            $('#profile-avatar-preview').on('load', function() {
                                console.log('✅ Avatar image loaded successfully');
                            }).on('error', function() {
                                console.error('❌ Avatar image failed to load, using default');
                                $(this).attr('src', '/img/avatar-default.svg');
                            });
                        } else {
                            console.log('⚠️ No profile picture or empty string, using default');
                        }
                    } else {
                        console.log('❌ API response invalid:', response);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('❌ AJAX Error:', {xhr, status, error});
                    console.error('Response Text:', xhr.responseText);
                }
            });
        }
        
        // ========== TOGGLE TRANSACTION HISTORY ==========
        function toggleTransactionHistory() {
            const content = document.getElementById('transactionHistoryContent');
            const icon = document.getElementById('transactionToggleIcon');
            
            if (content.style.display === 'none' || content.style.display === '') {
                // Show
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                // Hide
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }
        </script>
        
        <!-- Chat Widget -->
        <div th:replace="fragments/user/chat-widget :: chat-widget"></div>
    </body>
</html>
