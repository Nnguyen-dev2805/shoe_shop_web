<!doctype html>
<html class="no-js" lang="" xmlns:th="http://www.thymeleaf.org">

<!-- Mirrored from htmldemo.net/james/james/single-product.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 05 Nov 2024 02:19:15 GMT -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Single Shop || DeeG Shop</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- favicon
    ============================================ -->
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">

    <!-- Google Fonts
    ============================================ -->
    <link href='https://fonts.googleapis.com/css?family=Norican' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- Bootstrap CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Bootstrap CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <!-- owl.carousel CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.css">
    <link rel="stylesheet" href="/css/owl.transitions.css">
    <!-- jquery-ui CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <!-- meanmenu CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/meanmenu.min.css">
    <!-- nivoslider CSS
    ============================================ -->
    <link rel="stylesheet" href="/lib/css/nivo-slider.css">
    <link rel="stylesheet" href="/lib/css/preview.css">
    <!-- animate CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- magic CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/magic.css">
    <!-- normalize CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/normalize.css">
    <!-- main CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- style CSS
    ============================================ -->
    <link rel="stylesheet" href="/style.css">
    <!-- responsive CSS
    ============================================ -->
    <link rel="stylesheet" href="/css/responsive.css">
    <!-- modernizr JS
    ============================================ -->
    <script src="/js/vendor/modernizr-2.8.3.min.js"></script>
    <style>
        .fa-heart {
            color: red; /* Trái tim đỏ khi yêu thích */
        }

        .fa-heart-o {
            color: #ccc; /* Trái tim xám khi chưa yêu thích */
        }

        .rating-container {
            display: flex;
            gap: 5px;
        }

        .star {
            font-size: 30px;
            color: #ccc; /* Màu sao chưa được chọn */
            cursor: pointer;
        }

        .star.selected, .star.hover {
            color: gold; /* Màu sao được chọn hoặc hover */
        }
        
        /* Size buttons styling */
        .size-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .size-btn {
            min-width: 80px;
            padding: 10px 15px;
            border: 2px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }
        
        .size-btn:hover {
            border-color: rgb(245, 114, 98);
            color: rgb(245, 114, 98);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(245, 114, 98, 0.2);
        }
        
        .size-btn.active {
            border-color: rgb(245, 114, 98);
            background: rgb(245, 114, 98);
            color: white;
            font-weight: 600;
        }
        
        .size-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f5f5f5;
        }
        
        .size-btn.disabled:hover {
            transform: none;
            box-shadow: none;
            border-color: #ddd;
        }
        
        /* Stock info */
        .stock-info {
            margin-top: 15px;
            padding: 10px 15px;
            background: #f0f8ff;
            border-left: 4px solid #4CAF50;
            border-radius: 4px;
        }
        
        .stock-info.low-stock {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        .stock-info.out-of-stock {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        /* Quantity selector */
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .quantity-selector label {
            font-weight: 600;
            margin-right: 10px;
        }
        
        .qty-controls {
            display: flex;
            align-items: center;
            border: 2px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .qty-btn {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s;
            color: #333;
        }
        
        .qty-btn:hover {
            background: rgb(245, 114, 98);
            color: white;
        }
        
        .qty-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .qty-input {
            width: 60px;
            height: 40px;
            text-align: center;
            border: none;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            font-size: 16px;
            font-weight: 600;
        }
        
        .qty-input:focus {
            outline: none;
        }
        
        /* Price display */
        .price-breakdown {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        .price-row.total {
            font-size: 20px;
            font-weight: bold;
            color: rgb(245, 114, 98);
            border-top: 2px solid #ddd;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        /* Product image zoom effect */
        .single-product-img {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            background: white;
            padding: 20px;
        }
        
        .single-product-img img {
            width: 100%;
            height: auto;
            transition: transform 0.5s ease;
            cursor: zoom-in;
        }
        
        .single-product-img:hover img {
            transform: scale(1.1);
        }
        
        /* Product details card styling */
        .product-details-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            padding: 30px;
        }
        
        .product-name {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            text-decoration: none;
            display: block;
            margin-bottom: 15px;
            line-height: 1.3;
        }
        
        .product-name:hover {
            color: rgb(245, 114, 98);
        }
        
        /* Rating section */
        .rating-section {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }
        
        .rating-section .ratings {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rating-section .ratings i {
            color: #ffc107;
            font-size: 18px;
        }
        
        .rating-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .rating-info strong {
            font-size: 14px;
            color: #666;
        }
        
        /* Availability badge */
        .availability-badge {
            display: inline-block;
            padding: 8px 16px;
            background: #d4edda;
            color: #155724;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .availability-badge.out-stock {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Price section */
        .price-section {
            padding: 20px;
            background: linear-gradient(135deg, #fff5f3 0%, #ffe8e4 100%);
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #ffe0dc;
        }
        
        .item-price {
            margin: 0;
        }
        
        .item-price span {
            font-size: 36px;
            font-weight: 700;
            color: rgb(245, 114, 98);
            display: block;
        }
        
        /* Description section */
        .description-section {
            padding: 15px 0;
            margin-bottom: 20px;
        }
        
        .description-section p {
            font-size: 15px;
            line-height: 1.6;
            color: #666;
            margin: 0;
        }
        
        .description-section strong {
            color: #333;
            font-weight: 600;
        }
        
        /* Action buttons */
        .action {
            margin-bottom: 25px;
        }
        
        .add-to-links {
            display: flex;
            gap: 10px;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .add-to-links li a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border: 2px solid #ddd;
            border-radius: 50%;
            color: #666;
            transition: all 0.3s ease;
            background: white;
        }
        
        .add-to-links li a:hover {
            border-color: rgb(245, 114, 98);
            color: rgb(245, 114, 98);
            background: #fff5f3;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(245, 114, 98, 0.2);
        }
        
        .add-to-links li a i {
            font-size: 18px;
        }
        
        /* Size selection section */
        .size-selection-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .size-select label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: block;
        }
        
        .size-select label em {
            color: rgb(245, 114, 98);
        }
        
        /* Cart item container */
        .cart-item {
            margin-top: 20px;
            /*width: 100%;*/
            /*padding: 0;*/
        }
        
        .single-cart {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            /*padding: 0;*/
            /*margin: 0;*/
        }
        
        /* Add to cart button */
        .cart-btn {
            width: 100%;
            max-width: 100%;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgb(245, 114, 98);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(245, 114, 98, 0.3);
            text-align: center;
            display: block;
        }
        
        .cart-btn:hover:not(:disabled) {
            background: rgb(230, 99, 83);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 114, 98, 0.4);
        }
        
        .cart-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .cart-btn i {
            margin-right: 8px;
        }
        
        /* Divider */
        .divider {
            height: 1px;
            background: #eee;
            margin: 20px 0;
        }
    </style>
</head>
<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->

<!-- header area start -->
<header th:replace="~{fragments/user/header :: header}"></header>
<!-- header area end -->

<!-- single product area start -->
<div class="Single-product-location home2">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="location">
                    <ul>
                        <li><a href="/" title="go to homepage">Trang Chủ<span>/</span></a></li>
                        <li><strong> Chi Tiết sản phẩm</strong></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- single product area end -->
<!-- single product details start -->
<div class="single-product-details">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <div class="single-product-img tab-content">
                    <div class="single-pro-main-image tab-pane active" id="pro-large-img-1">
                        <a href="#"><img class="optima_zoom" id="product-image" src="" alt="Product Image"/></a>
                    </div>
                </div>
                
                <!-- Address Selection Section -->
                <div style="margin-top: 30px; background: rgb(229, 229, 229); border-radius: 10px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom: 20px; color: rgb(224, 53, 80); border-bottom: none; padding-bottom: 10px; font-weight: bold;">
                        <i class="fa fa-map-marker"></i> ĐỊA CHỈ GIAO HÀNG
                    </h4>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <select name="addressId" id="addressSelectProduct" required 
                                class="form-control" 
                                style="border: 1px solid #ccc; border-radius: 8px; padding: 14px; font-size: 15px; background-color: white; font-weight: 500;">
                            <!-- User addresses will be loaded dynamically via AJAX -->
                            <option value="">
                                <i class="fa fa-spinner fa-spin"></i> Đang tải địa chỉ...
                            </option>
                        </select>
                        <small style="color: rgb(35, 34, 34); margin-top: 10px; display: block;">
                            <i class="fa fa-info-circle"></i> Chọn địa chỉ giao hàng để sử dụng tính năng "Mua Ngay"
                        </small>
                    </div>
                    <a href="/user/my-account" 
                       class="btn btn-block btn-add-address"
                       style="background: rgb(224, 53, 80); color: white; padding: 12px; border-radius: 8px; text-decoration: none; font-weight: 600; display: block; text-align: center; transition: all 0.3s; border: none;">
                        <i class="fa fa-plus-circle"></i> Thêm Địa Chỉ Mới
                    </a>
                </div>
            </div>
            <div class="col-lg-6">
                <form action="#" method="post">
                    <div class="single-product-details product-details-card">
                        <!-- Product Title -->
                        <a href="#" class="product-name" id="product-title">Loading...</a>
                        
                        <!-- Rating Section -->
                        <div class="rating-section">
                            <div class="ratings">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                            </div>
                            <div class="rating-info">
                                <strong id="product-rating">Điểm đánh giá: 0.0</strong>
                                <strong id="product-reviews">Chưa có đánh giá</strong>
                            </div>
                        </div>
                        
                        <!-- Availability Badge -->
                        <span class="availability-badge">
                            <i class="fa fa-check-circle"></i> Còn hàng
                        </span>
                        
                        <!-- Price Section -->
                        <div class="price-section">
                            <div class="item-price">
                                <span id="product-price">0 đ</span>
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <div class="description-section">
                            <p><strong>Mô tả:</strong> <span id="product-description">Loading...</span></p>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <!-- Action Buttons -->
                        <div class="action">
                            <ul class="add-to-links">
                                <li>
                                    <a href="#" class="add-to-wishlist" data-product-id="" title="Thêm vào yêu thích">
                                        <i class="fa fa-heart-o"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="#" title="So sánh">
                                        <i class="fa fa-refresh"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="#" title="Chia sẻ">
                                        <i class="fa fa-share-alt"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Size Selection -->
                        <div class="size-selection-section">
                        <div class="select-catagory">
                            <div class="size-select">
                                <label class="required">
                                    <em>*</em> Chọn Size
                                </label>
                                <div class="size-buttons" id="size-buttons">
                                    <!-- Size buttons will be loaded via AJAX -->
                                    <p>Đang tải sizes...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stock Information -->
                        <div class="stock-info" id="stock-info" style="display: none;">
                            <i class="fa fa-check-circle"></i>
                            <strong>Số lượng còn lại:</strong> <span id="stock-quantity">10</span> sản phẩm
                        </div>
                        
                        <!-- Quantity Selector -->
                        <div class="quantity-selector" id="quantity-selector" style="display: none;">
                            <label>Số lượng:</label>
                            <div class="qty-controls">
                                <button type="button" class="qty-btn" id="qty-minus">-</button>
                                <input type="text" class="qty-input" id="qty-input" name="quantity" value="1" readonly>
                                <button type="button" class="qty-btn" id="qty-plus">+</button>
                            </div>
                        </div>
                        
                        <!-- Price Breakdown -->
                        <div class="price-breakdown" id="price-breakdown" style="display: none;">
                            <div class="price-row">
                                <span>Giá cơ bản:</span>
                                <span id="base-price-display">0 đ</span>
                            </div>
                            <div class="price-row">
                                <span>Phụ phí size:</span>
                                <span id="size-fee-display">0 đ</span>
                            </div>
                            <div class="price-row total">
                                <span>Tổng cộng:</span>
                                <span id="final-price">0 đ</span>
                            </div>
                        </div>
                        </div>
                        
                        <div class="cart-item">
                            <div class="single-cart">
                                <!-- Hidden inputs -->
                                <input type="hidden" id="productDetailId" name="productDetailId" value="">
                                <input type="hidden" id="selectedSize" name="selectedSize" value="">
                                
                                <!-- Action buttons container -->
                                <div style="display: flex; gap: 10px; width: 100%;">
                                    <button class="cart-btn" type="button" id="add-to-cart-btn" disabled style="flex: 1;">
                                        <i class="fa fa-shopping-cart"></i> Thêm Vào Giỏ
                                    </button>
                                    <button class="cart-btn" type="button" id="buy-now-btn" disabled 
                                            style="flex: 1; background: #ff6b35; box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);">
                                        <i class="fa fa-bolt"></i> Mua Ngay
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!-- Alert message will be shown here -->
        </div>
    </div>
</div>
<!-- single product details end -->
<!-- single product tab start -->
<div class="single-product-tab-area">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="single-product-tab">
                    <ul class="nav single-product-tab-navigation" role="tablist">
<!--                        <li role="presentation">-->
<!--                            <a class="active" href="#tab1" aria-controls="tab1" role="tab" data-bs-toggle="tab">Product-->
<!--                                Description</a>-->
<!--                        </li>-->
                        <li role="presentation">
                            <a href="#tab2" aria-controls="tab2" role="tab" data-bs-toggle="tab" id="viewAllReview" data-product-id="">Xem danh sách đánh giá</a>
                        </li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content single-product-page">
<!--                        <div role="tabpanel" class="tab-pane fade show active" id="tab1">-->
<!--                            <div class="single-p-tab-content">-->
<!--                                <p>Nunc facilisis sagittis ullamcorper. Proin lectus ipsum, gravida et mattis vulputate,-->
<!--                                    tristique ut lectus. Sed et lorem nunc. Vestibulum ante ipsum primis in faucibus-->
<!--                                    orci luctus et ultrices posuere cubilia Curae; Aenean eleifend laoreet congue.-->
<!--                                    Vivamus adipiscing nisl ut dolor dignissim semper. Nulla luctus malesuada tincidunt.-->
<!--                                    Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos-->
<!--                                    himenaeos. Integer enim purus, posuere at ultricies eu, placerat a felis.-->
<!--                                    Suspendisse aliquet urna pretium eros convallis interdum. Quisque in arcu id dui-->
<!--                                    vulputate mollis eget non arcu. Aenean et nulla purus. Mauris vel tellus non nunc-->
<!--                                    mattis lobortis. </p>-->
<!--                            </div>-->
<!--                        </div>-->
                        <div role="tabpanel" class="tab-pane fade" id="tab2">
                            <div class="single-p-tab-content" id="reviewsContent">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- single product tab end -->
<!-- upsell product area start-->
<!--        <div class="upsell-product home2">-->
<!--            <div class="container">-->
<!--                <div class="row">-->
<!--                    <div class="col-md-12">-->
<!--                        <div class="product-title">-->
<!--                            <h2>upsell products</h2>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="row">-->
<!--                    <div class="upsell-slider">-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/25.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/26.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/23.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/24.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/21.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/22.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/19.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/20.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/17.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/18.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/15.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/16.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/13.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/14.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/11.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/12.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="list-product-info">-->
<!--                                    <div class="price-rating">-->
<!--                                        <div class="ratings">-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star"></i>-->
<!--                                            <i class="fa fa-star-half-o"></i>-->
<!--                                            <a href="#" class="review">1 Review(s)</a>-->
<!--                                            <a href="#" class="add-review">Add Your Review</a>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!-- upsell product area end-->
<!-- related product area start-->
<!--        <div class="related-product home2">-->
<!--            <div class="container">-->
<!--                <div class="row">-->
<!--                    <div class="col-md-12">-->
<!--                        <div class="product-title">-->
<!--                            <h2>related products</h2>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="row">-->
<!--                    <div class="related-slider">-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/25.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/26.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/23.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/24.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/21.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/22.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/19.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/20.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/17.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/18.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/15.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/16.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/13.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/14.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="single-product">-->
<!--                                <div class="product-img">-->
<!--                                    <a href="single-product.html">-->
<!--                                        <img src="img/product/11.png" alt="" class="primary-img">-->
<!--                                        <img src="img/product/12.png" alt="" class="secondary-img">-->
<!--                                    </a>-->
<!--                                </div>-->
<!--                                <div class="product-price">-->
<!--                                    <div class="product-name">-->
<!--                                        <a href="single-product.html" title="Fusce aliquam">Fusce aliquam</a>-->
<!--                                    </div>-->
<!--                                    <div class="price-rating">-->
<!--                                        <span>$170.00</span>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!-- related product area end-->

<!-- footer area start -->
<div th:include="~{fragments/web/footer.html}"></div>
<!-- footer area end -->

<!-- jquery
============================================ -->
<script src="/js/vendor/jquery-1.12.4.min.js"></script>
<!-- bootstrap JS
============================================ -->
<script src="/js/bootstrap.min.js"></script>
<!-- wow JS
============================================ -->
<script src="/js/wow.min.js"></script>
<!-- price-slider JS
============================================ -->
<script src="/js/jquery-price-slider.js"></script>
<!-- nivoslider JS
============================================ -->
<script src="/lib/js/jquery.nivo.slider.js"></script>
<script src="/lib/home.js"></script>
<!-- meanmenu JS
============================================ -->
<script src="/js/jquery.meanmenu.js"></script>
<!-- owl.carousel JS
============================================ -->
<script src="/js/owl.carousel.min.js"></script>
<!-- elevatezoom JS
============================================ -->
<script src="/js/jquery.elevatezoom.js"></script>
<!-- scrollUp JS
============================================ -->
<script src="/js/jquery.scrollUp.min.js"></script>
<!-- plugins JS
============================================ -->
<script src="/js/plugins.js"></script>
<!-- main JS
============================================ -->
<script src="/js/main.js"></script>
<!-- Size price calculator đã được chuyển vào product-details.js -->
<script>
    $(document).ready(function () {
        // Bắt sự kiện khi nhấn vào liên kết "add-to-wishlist"
        $('.add-to-wishlist').click(function (e) {
            e.preventDefault(); // Ngăn chặn hành động mặc định của liên kết

            var productIdStr = $(this).data('product-id'); // Lấy productId từ thuộc tính data-product-id
            var productId = parseInt(productIdStr, 10); // Chuyển đổi productId sang số nguyên
            if (isNaN(productId) || productId <= 0) {
                alert('ID sản phẩm không hợp lệ');
                return;
            }

            var heartIcon = $(this).find('i'); // Lấy thẻ <i> chứa biểu tượng trái tim

            // Gửi yêu cầu AJAX đến server
            $.ajax({
                url: '/wishlist/toggle', // URL của endpoint thêm/xóa sản phẩm vào wishlist
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({productId: productId}), // Gửi productId dưới dạng JSON
                success: function (response) {
                    if (response === 'ADDED') {
                        // Nếu thêm thành công, thay đổi biểu tượng trái tim thành màu đỏ
                        heartIcon.removeClass('fa-heart-o').addClass('fa-heart');
                        heartIcon.css('color', 'red');
                    } else if (response === 'REMOVED') {
                        // Nếu bị xóa, đổi biểu tượng trái tim thành không màu
                        heartIcon.removeClass('fa-heart').addClass('fa-heart-o');
                        heartIcon.css('color', '');
                    } else if (response === 'LOGIN_REQUIRED') {
                        alert('Vui lòng đăng nhập để thêm sản phẩm vào wishlist');
                    } else if (response === 'ALREADY_EXISTS') {
                        alert('Sản phẩm đã có trong wishlist');
                    }
                },
                error: function () {
                    alert('Đã có lỗi xảy ra, vui lòng thử lại sau');
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function () {
        // Hàm lấy ProductID từ URL
        function getProductIdFromUrl() {
            var path = window.location.pathname; // Lấy đường dẫn hiện tại
            var parts = path.split('/'); // Tách đường dẫn thành mảng
            return parts[parts.length - 1]; // Phần cuối cùng là ProductID
        }

        // Hàm load review dựa vào ProductID và số trang
        function loadReviews(page) {
            var productId = getProductIdFromUrl(); // Lấy ProductID từ URL

            // Debug: kiểm tra giá trị
            console.log('Product ID:', productId, 'Page:', page);

            // Gửi request Ajax
            $.get("/rating", { productId: productId, page: page }, function (data) {
                // Cập nhật nội dung của reviewsContent
                $('#reviewsContent').html(data);

                // Gán lại sự kiện click cho các nút phân trang sau khi nội dung được cập nhật
                bindPaginationLinks();
            }).fail(function (error) {
                console.error('Error loading reviews:', error);
            });
        }

        // Hàm gắn sự kiện click cho các link phân trang
        function bindPaginationLinks() {
            // Lấy các link phân trang
            $('.pagination-link').off('click').on('click', function (e) {
                e.preventDefault(); // Ngăn chuyển hướng mặc định
                var page = $(this).data('page'); // Lấy số trang từ thuộc tính data-page

                // Kiểm tra số trang hợp lệ
                if (!isNaN(page)) {
                    loadReviews(page); // Gọi loadReviews để tải dữ liệu của trang mới
                } else {
                    console.error('Invalid page number');
                }
            });
        }

        // Sự kiện khi bấm vào nút "View all review"
        $('#viewAllReview').click(function (e) {
            e.preventDefault(); // Ngăn chuyển hướng mặc định

            // Tải dữ liệu review từ trang đầu tiên (page = 0)
            loadReviews(0);
        });

        // Gắn sự kiện click cho các nút phân trang (trường hợp nội dung ban đầu đã có sẵn)
        bindPaginationLinks();
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const stars = document.querySelectorAll('.star');
        const ratingInput = document.getElementById('rating');
        const form = document.getElementById('ratingForm');  // Lấy form theo id
        if (!form) return;

        form.addEventListener("submit", function (e) {
            // Kiểm tra nếu ratingInput không có giá trị
            if (!ratingInput.value) {
                e.preventDefault(); // Ngừng gửi form
                alert("Vui lòng chọn số sao trước khi gửi đánh giá!");
            }
        });

        stars.forEach((star, index) => {
            star.addEventListener('click', () => {
                // Kiểm tra nếu sao đã được chọn rồi
                if (ratingInput.value === star.dataset.value) {
                    // Nếu đã chọn, reset lại trạng thái sao và giá trị rating
                    ratingInput.value = '';
                    stars.forEach(s => s.classList.remove('selected'));
                } else {
                    // Nếu chưa chọn, gán giá trị rating và thay đổi trạng thái sao
                    ratingInput.value = star.dataset.value;
                    stars.forEach((s, i) => {
                        if (i <= index) {
                            s.classList.add('selected');
                        } else {
                            s.classList.remove('selected');
                        }
                    });
                }
            });

            // Tạo hiệu ứng hover từ trái sang phải
            star.addEventListener('mouseover', () => {
                stars.forEach((s, i) => {
                    if (i <= index) {
                        s.classList.add('hover');
                    } else {
                        s.classList.remove('hover');
                    }
                });
            });

            // Khôi phục trạng thái khi chuột rời
            star.addEventListener('mouseout', () => {
                stars.forEach((s) => s.classList.remove('hover'));
            });
        });
    });
</script>

<!-- Product Details AJAX Script -->
<script src="/js/web/product-details.js"></script>

<!-- Buy Now Feature Script -->
<script>
$(document).ready(function() {
    // Load addresses on page load
    loadProductAddresses();
    
    /**
     * Load user addresses into dropdown
     */
    function loadProductAddresses() {
        $.ajax({
            url: '/api/user/addresses',
            method: 'GET',
            success: function(response) {
                console.log('Address API response:', response);
                
                if (response.success && response.addresses) {
                    const addresses = response.addresses;
                    const $select = $('#addressSelectProduct');
                    $select.empty();
                    
                    if (addresses.length === 0) {
                        $select.append('<option value="">Chưa có địa chỉ giao hàng</option>');
                        return;
                    }
                    
                    // Add default option
                    $select.append('<option value="">-- Chọn địa chỉ giao hàng --</option>');
                    
                    // Add addresses
                    addresses.forEach(function(address) {
                        const isDefault = address.isDefault;
                        const option = `<option value="${address.id}" ${isDefault ? 'selected' : ''}>
                            ${address.address} ${isDefault ? '(Mặc định)' : ''}
                        </option>`;
                        $select.append(option);
                    });
                } else {
                    $('#addressSelectProduct').html('<option value="">Không thể tải địa chỉ</option>');
                }
            },
            error: function(xhr, status, error) {
                console.error('Error loading addresses:', error);
                $('#addressSelectProduct').html('<option value="">Lỗi khi tải địa chỉ</option>');
            }
        });
    }
    
    /**
     * Handle Buy Now button click
     */
    $('#buy-now-btn').on('click', function() {
        // Validate selection
        const productDetailId = $('#productDetailId').val();
        const quantity = parseInt($('#qty-input').val());
        const selectedSize = $('#selectedSize').val();
        const selectedAddressId = $('#addressSelectProduct').val();
        
        if (!productDetailId) {
            alert('Vui lòng chọn size sản phẩm!');
            return;
        }
        
        if (quantity < 1) {
            alert('Số lượng phải lớn hơn 0!');
            return;
        }
        
        if (!selectedAddressId) {
            alert('Vui lòng chọn địa chỉ giao hàng!');
            return;
        }
        
        // Get product detail data from window object (loaded by product-details.js)
        const productDetail = window.currentProductDetail;
        
        if (!productDetail) {
            alert('Không tải được thông tin sản phẩm. Vui lòng thử lại!');
            return;
        }

        // Calculate price
        const basePrice = window.currentProduct.price || 0;
        const sizePrice = productDetail.priceadd || 0;
        const unitPrice = basePrice + sizePrice;
        
        // Create order item data (same format as cart items)
        const orderItem = {
            id: productDetail.id, // product detail ID
            product: {
                id: productDetail.id,
                product: window.currentProduct,
                size: selectedSize,
                priceadd: sizePrice,
                quantity: productDetail.quantity
            },
            quantity: quantity,
            price: unitPrice
        };
        
        // Store in sessionStorage
        sessionStorage.setItem('selectedItems', JSON.stringify([orderItem]));
        sessionStorage.setItem('selectedAddressId', selectedAddressId); // Store selected address
        sessionStorage.setItem('cartId', ''); // No cart ID for buy now
        sessionStorage.setItem('buyNowMode', 'true'); // Flag to indicate buy now mode
        
        // Redirect to payment page
        window.location.href = '/user/payment';
    });
});

// Load ratings when tab is clicked
$(document).ready(function() {
    // Function to get product ID from URL path (same as existing function)
    function getProductIdFromUrl() {
        var path = window.location.pathname;
        var parts = path.split('/');
        return parts[parts.length - 1];
    }
    
    // Get product ID and set it to data attribute
    const productId = getProductIdFromUrl();
    console.log('Product ID from URL:', productId);
    
    if (productId) {
        $('#viewAllReview').data('product-id', productId);
    }
    
    // Handle tab click to load ratings
    $('#viewAllReview').on('click', function() {
        const productId = $(this).data('product-id');
        console.log('Loading ratings for product ID:', productId);
        if (productId) {
            loadProductRatings(productId);
        } else {
            console.error('No product ID found');
            $('#reviewsContent').html('<p class="text-danger">Không tìm thấy ID sản phẩm</p>');
        }
    });
    
    // Function to load and display ratings
    function loadProductRatings(productId) {
        console.log('Making API call to:', '/api/ratings/product/' + productId);
        
        $.ajax({
            url: '/api/ratings/product/' + productId,
            method: 'GET',
            success: function(response) {
                console.log('API Response:', response);
                if (response.success) {
                    console.log('Ratings found:', response.ratings.length);
                    console.log('Summary:', response.summary);
                    
                    // Store all ratings for button counting (only on initial load)
                    if (!currentFilterState) {
                        allRatings = response.ratings;
                    }
                    
                    displayRatings(response.ratings, response.summary, currentFilterState);
                } else {
                    console.error('API Error:', response.message);
                    $('#reviewsContent').html('<p class="text-danger">' + response.message + '</p>');
                }
            },
            error: function(xhr, status, error) {
                console.error('AJAX Error:', xhr, status, error);
                console.error('Response Text:', xhr.responseText);
                $('#reviewsContent').html('<p class="text-danger">Lỗi khi tải danh sách đánh giá: ' + error + '</p>');
            }
        });
    }
    
    // Function to display ratings
    function displayRatings(ratings, summary, currentFilter) {
        const reviewsContent = $('#reviewsContent');
        
        if (ratings.length === 0) {
            let message = 'Chưa có đánh giá nào cho sản phẩm này.';
            if (currentFilter) {
                if (currentFilter.star) {
                    message = `Chưa có đánh giá ${currentFilter.star} sao nào.`;
                } else if (currentFilter.hasComment) {
                    message = 'Chưa có đánh giá nào có bình luận.';
                } else if (currentFilter.hasImage) {
                    message = 'Chưa có đánh giá nào có hình ảnh.';
                }
            }
            reviewsContent.html(`<div style="text-align: center; padding: 40px; color: #999;"><p>${message}</p></div>`);
            return;
        }
        
        // Get real data from summary
        const averageStars = summary ? summary.averageStars || 0.0 : 0.0;
        const totalReviewers = summary ? summary.totalReviewers || 0 : 0;
        
        let html = `
            <div class="product-ratings" style="background: #fff; border-radius: 8px; padding: 20px;">
                <div class="product-rating-overview" style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #f0f0f0;">
                    <div class="product-rating-overview__briefing" style="display: flex; align-items: center; gap: 20px;">
                        <div class="product-rating-overview__score-wrapper" style="text-align: center;">
                            <span class="product-rating-overview__rating-score" style="font-size: 32px; font-weight: bold; color: #ee4d2d;">${averageStars.toFixed(1)}</span>
                            <span class="product-rating-overview__rating-score-out-of" style="color: #999; font-size: 14px;"> trên 5</span>
                        </div>
                        <div class="shopee-rating-stars" style="display: flex; gap: 2px;">
                            ${generateShopeeStars(averageStars)}
                        </div>
                    </div>
                </div>
                <div class="product-rating-overview__filters" style="margin-bottom: 20px; display: flex; gap: 8px; flex-wrap: wrap;">
                    ${window.generateFilterButtons(ratings, summary, currentFilter)}
                </div>
                <div class="product-ratings__list">
        `;
        
        ratings.forEach(function(rating) {
            const stars = generateShopeeStars(rating.star);
            const date = new Date(rating.createdDate).toLocaleDateString('vi-VN');
            const userName = rating.userName || 'Khách hàng';
            
            html += `
                <div class="q2b7Oq" style="border-bottom: 1px solid #f0f0f0; padding: 20px 0;">
                    <div class="kRbrbH" style="display: flex; gap: 12px;">
                        <div class="shopee-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <svg width="20" height="20" viewBox="0 0 15 15" fill="#999">
                                <circle cx="7.5" cy="4.5" fill="none" r="3.8" stroke="#999" stroke-width="1"></circle>
                                <path d="m1.5 14.2c0-3.3 2.7-6 6-6s6 2.7 6 6" fill="none" stroke="#999" stroke-width="1"></path>
                            </svg>
                        </div>
                        <div class="A7MThp" style="flex: 1;">
                            <div class="d72He7" style="margin-bottom: 8px;">
                                <div class="InK5kS" style="font-weight: 600; color: #333; margin-bottom: 4px;">${userName}</div>
                                <div class="BnXxkm" style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <div class="rGdC5O" style="display: flex; gap: 1px;">
                                        ${stars}
                                    </div>
                                    <span style="background: #f0f0f0; padding: 2px 8px; border-radius: 12px; font-size: 12px; color: #666;">
                                        Size ${rating.productSize}
                                    </span>
                                </div>
                                <div class="j5ucs4">
                                    <div class="XYk98l" style="color: #999; font-size: 12px;">${date}</div>
                                </div>
                            </div>
                            <div class="meQyXP">
                                <div style="color: #888; font-size: 13px; margin-bottom: 8px;">
                                    📦 ${rating.productName}
                                </div>
                                <div class="YNedDV" style="color: #333; line-height: 1.5; margin-bottom: 12px;">${rating.comment}</div>
                                ${rating.image ? `
                                    <div class="ZBCPg1">
                                        <div class="rating-media-list">
                                            <div class="rating-media-list__container" style="display: flex; gap: 8px;">
                                                <div class="rating-media-list__image-wrapper" style="width: 72px; height: 72px; border-radius: 4px; overflow: hidden; cursor: pointer;">
                                                    <img src="${rating.image}" alt="Review image" style="width: 100%; height: 100%; object-fit: cover;">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += `
                </div>
            </div>
        `;
        
        reviewsContent.html(html);
    }
    
    // Function to generate filter buttons - moved outside document.ready
    window.generateFilterButtons = function(ratings, summary, currentFilter) {
        const productId = $('#viewAllReview').data('product-id');
        let html = '';
        
        // Tất cả button
        const isAllActive = !currentFilter || (!currentFilter.star && !currentFilter.hasComment && !currentFilter.hasImage);
        html += `
            <div class="product-rating-overview__filter ${isAllActive ? 'product-rating-overview__filter--active' : ''}" 
                 style="padding: 8px 16px; border: 1px solid ${isAllActive ? '#ee4d2d' : '#ddd'}; border-radius: 4px; cursor: pointer; background: ${isAllActive ? '#ee4d2d' : 'white'}; color: ${isAllActive ? 'white' : '#333'}; font-size: 14px;"
                 onclick="window.filterRatings(${productId}, null, null, null, this)">
                <span>Tất cả</span>
            </div>
        `;
        
        // Show all star filter buttons (5, 4, 3, 2, 1) - use allRatings for counting
        for (let star = 5; star >= 1; star--) {
            const count = window.getStarCount(allRatings, star);
            if (count > 0) {
                const isActive = currentFilter && currentFilter.star === star;
                html += `
                    <div class="product-rating-overview__filter ${isActive ? 'product-rating-overview__filter--active' : ''}" 
                         style="padding: 8px 16px; border: 1px solid ${isActive ? '#ee4d2d' : '#ddd'}; border-radius: 4px; cursor: pointer; background: ${isActive ? '#ee4d2d' : 'white'}; color: ${isActive ? 'white' : '#333'}; font-size: 14px;"
                         onclick="window.filterRatings(${productId}, ${star}, null, null, this)">
                        <span>${star} Sao (${count})</span>
                    </div>
                `;
            }
        }
        
        // Image filter - use allRatings for counting
        const imageCount = window.getImageCount(allRatings);
        if (imageCount > 0) {
            const isActive = currentFilter && currentFilter.hasImage === true;
            html += `
                <div class="product-rating-overview__filter ${isActive ? 'product-rating-overview__filter--active' : ''}" 
                     style="padding: 8px 16px; border: 1px solid ${isActive ? '#ee4d2d' : '#ddd'}; border-radius: 4px; cursor: pointer; background: ${isActive ? '#ee4d2d' : 'white'}; color: ${isActive ? 'white' : '#333'}; font-size: 14px;"
                     onclick="window.filterRatings(${productId}, null, null, true, this)">
                    <span>Có hình ảnh / video (${imageCount})</span>
                </div>
            `;
        }
        
        return html;
    };
    
    // Helper functions to count ratings - moved outside document.ready
    window.getStarCount = function(ratings, star) {
        return ratings.filter(rating => rating.star === star).length;
    };
    
    window.getCommentCount = function(ratings) {
        return ratings.filter(rating => rating.comment && rating.comment.trim() !== '').length;
    };
    
    window.getImageCount = function(ratings) {
        return ratings.filter(rating => rating.image && rating.image.trim() !== '').length;
    };
    
    // Global variable to store current filter state
    let currentFilterState = null;
    
    // Global variable to store all ratings for button counting
    let allRatings = [];
    
    // Function to filter ratings - moved outside document.ready
    window.filterRatings = function(productId, star, hasComment, hasImage, clickedElement) {
        // Store current filter state
        currentFilterState = {
            star: star,
            hasComment: hasComment,
            hasImage: hasImage
        };
        
        // Build query parameters
        let url = '/api/ratings/product/' + productId;
        const params = [];
        
        if (star !== null) params.push('star=' + star);
        if (hasComment !== null) params.push('hasComment=' + hasComment);
        if (hasImage !== null) params.push('hasImage=' + hasImage);
        
        if (params.length > 0) {
            url += '?' + params.join('&');
        }
        
        console.log('Filtering with URL:', url);
        console.log('Current filter state:', currentFilterState);
        
        // Make API call
        $.ajax({
            url: url,
            method: 'GET',
            success: function(response) {
                console.log('Filtered API Response:', response);
                if (response.success) {
                    console.log('Filtered ratings found:', response.ratings.length);
                    displayRatings(response.ratings, response.summary, currentFilterState);
                } else {
                    console.error('API Error:', response.message);
                    $('#reviewsContent').html('<p class="text-danger">' + response.message + '</p>');
                }
            },
            error: function(xhr, status, error) {
                console.error('AJAX Error:', xhr, status, error);
                $('#reviewsContent').html('<p class="text-danger">Lỗi khi lọc đánh giá: ' + error + '</p>');
            }
        });
    };
    
    // Function to generate star HTML
    function generateStars(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                stars += '<i class="fa fa-star" style="color: #ffc107;"></i>';
            } else {
                stars += '<i class="fa fa-star-o" style="color: #ddd;"></i>';
            }
        }
        return stars;
    }
    
    // Function to generate Shopee-style stars
    function generateShopeeStars(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= Math.floor(rating)) {
                // Full star
                stars += `
                    <svg width="15" height="15" viewBox="0 0 15 15" fill="#ffc107">
                        <polygon points="7.5 .8 9.7 5.4 14.5 5.9 10.7 9.1 11.8 14.2 7.5 11.6 3.2 14.2 4.3 9.1 .5 5.9 5.3 5.4" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"></polygon>
                    </svg>
                `;
            } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                // Half star
                const percentage = (rating % 1) * 100;
                stars += `
                    <div style="position: relative; width: 15px; height: 15px;">
                        <svg width="15" height="15" viewBox="0 0 15 15" fill="#ddd">
                            <polygon points="7.5 .8 9.7 5.4 14.5 5.9 10.7 9.1 11.8 14.2 7.5 11.6 3.2 14.2 4.3 9.1 .5 5.9 5.3 5.4" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"></polygon>
                        </svg>
                        <div style="position: absolute; top: 0; left: 0; width: ${percentage}%; height: 100%; overflow: hidden;">
                            <svg width="15" height="15" viewBox="0 0 15 15" fill="#ffc107">
                                <polygon points="7.5 .8 9.7 5.4 14.5 5.9 10.7 9.1 11.8 14.2 7.5 11.6 3.2 14.2 4.3 9.1 .5 5.9 5.3 5.4" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"></polygon>
                            </svg>
                        </div>
                    </div>
                `;
            } else {
                // Empty star
                stars += `
                    <svg width="15" height="15" viewBox="0 0 15 15" fill="#ddd">
                        <polygon points="7.5 .8 9.7 5.4 14.5 5.9 10.7 9.1 11.8 14.2 7.5 11.6 3.2 14.2 4.3 9.1 .5 5.9 5.3 5.4" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"></polygon>
                    </svg>
                `;
            }
        }
        return stars;
    }
});
</script>

<!-- Chat Widget -->
<div th:replace="fragments/user/chat-widget :: chat-widget"></div>
</body>

<!-- Mirrored from htmldemo.net/james/james/single-product.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 05 Nov 2024 02:19:16 GMT -->
</html>
