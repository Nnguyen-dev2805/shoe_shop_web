<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">


<!-- Mirrored from techzaa.in/larkon/admin/order-detail.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Nov 2024 14:46:46 GMT -->
<head>
     <!-- Title Meta -->
     <meta charset="utf-8" />
     <title>Chi Ti·∫øt ƒê∆°n H√†ng</title>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta name="description" content="A fully responsive premium admin dashboard template" />
     <meta name="author" content="Techzaa" />
     <meta http-equiv="X-UA-Compatible" content="IE=edge" />
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <!-- App favicon -->
     <link rel="shortcut icon" href="/assets/images/favicon.ico">

     <!-- Vendor css (Require in all Page) -->
     <link href="/assets/css/vendor.min.css" rel="stylesheet" type="text/css" />

     <!-- Icons css (Require in all Page) -->
     <link href="/assets/css/icons.min.css" rel="stylesheet" type="text/css" />

     <!-- App css (Require in all Page) -->
     <link href="/assets/css/app.min.css" rel="stylesheet" type="text/css" />

     <!-- Theme Config js (Require in all Page) -->
     <script src="/assets/js/config.js"></script>
</head>

<body>

     <!-- START Wrapper -->
     <div class="wrapper">

          <!-- ========== Topbar Start ========== -->
          <div th:insert="~{fragments/shipper/header.html}"></div>
          <!-- ========== Topbar End ========== -->

          <!-- ========== App Menu Start ========== -->
          <div th:insert="~{fragments/shipper/menu_app.html}"></div>
          <!-- ========== App Menu End ========== -->

          <!-- ==================================================== -->
          <!-- Start right Content here -->
          <!-- ==================================================== -->

          <div class="page-content">

               <!-- Start Container -->
               <div class="container-xxl">

                    <div class="row">
                         <div class="col-xl-9 col-lg-8">
                              <div class="row">
                                   <div class="col-lg-12">
                                        <div class="card">
                                             <div class="card-body">
                                                  <div>
                                                       <h4 class="fw-medium text-dark d-flex align-items-center gap-2">
                                                            <span th:text="${order.id}"></span>
                                                            <span class="badge bg-success-subtle text-success px-2 py-1 fs-13" th:text="${order.payOption}"></span>
                                                            <span id="status" class="border border-warning text-warning fs-13 px-2 py-1 rounded" th:text="${order.status}"></span>
                                                       </h4>
                                                       <p class="mb-0 text-muted">
                                                            <i class='bx bx-calendar'></i> Ng√†y t·∫°o: 
                                                            <span class="fw-medium" th:text="${#dates.format(order.createdDate, 'dd/MM/yyyy HH:mm')}"></span>
                                                       </p>
                                                  </div>

                                             </div>
                                             <div class="card-footer d-flex flex-wrap align-items-center justify-content-between bg-light-subtle gap-2">
                                                  <p class="border rounded mb-0 px-2 py-1 bg-body"><i class='bx bx-arrow-from-left align-middle fs-16'></i> Last updated date: <span class="text-dark fw-medium" th:text="${#dates.format(shipper.updatedDate, 'MMM dd, yyyy')}"></span></p>
                                             </div>
                                        </div>
                                        <div class="card">
                                             <div class="card-header">
                                                  <h4 class="card-title">Product</h4>
                                             </div>
                                             <div class="card-body">
                                                  <div class="table-responsive">
                                                       <table class="table align-middle mb-0 table-hover table-centered">
                                                            <thead class="bg-light-subtle border-bottom">
                                                            <tr>
                                                                 <th>Product Name & Size</th>
                                                                 <th>Quantity</th>
                                                                 <th>Price</th>
                                                                 <th>Amount</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr th:each="detail: ${list}">
                                                                 <td th:text="${detail.product_name}"></td>
                                                                 <td th:text="${detail.quantity}"></td>
                                                                 <td th:text="${detail.price}"></td>
                                                                 <td th:text="${detail.amount}"></td>
                                                            </tr>
                                                            </tbody>
                                                       </table>
                                                  </div>
                                             </div>
                                        </div>
                                        <div class="card">
                              <div class="card-header">
                                   <h4 class="card-title">Shipping Detail</h4>
                              </div>
                              <div class="card-body">
                                   <!-- Ghi ch√∫ -->
                                   <div class="mb-3">
                                        <label for="shipperNote" class="form-label fw-medium">
                                             <i class='bx bx-note'></i> Ghi Ch√∫ Giao H√†ng
                                        </label>
                                        <textarea id="shipperNote" 
                                                  class="form-control" 
                                                  rows="3" 
                                                  placeholder="Nh·∫≠p ghi ch√∫ v·ªÅ qu√° tr√¨nh giao h√†ng (v·ªã tr√≠, t√¨nh tr·∫°ng h√†ng, ghi ch√∫ kh√°ch h√†ng...)">
                                        </textarea>
                                        <small class="text-muted">Ghi ch√∫ n√†y s·∫Ω ƒë∆∞·ª£c l∆∞u v√†o l·ªãch s·ª≠ giao h√†ng</small>
                                   </div>
                                   
                                   <div class="d-flex gap-2 justify-content-end">
                                        <button type="button" 
                                                th:onclick="|saveNote(${shipper.id})|"
                                                class="btn btn-outline-primary btn-sm">
                                             <i class='bx bx-save'></i> L∆∞u Ghi Ch√∫
                                        </button>
                                   </div>
                              </div>
                              
                              <!-- Action Buttons - Ch·ªâ hi·ªán khi status = SHIPPED -->
                              <div class="card-body border-top" th:if="${order.status == T(com.dev.shoeshop.enums.ShipmentStatus).SHIPPED}">
                                   <div class="alert alert-info mb-3">
                                        <i class='bx bx-info-circle'></i> 
                                        ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c giao. Vui l√≤ng x√°c nh·∫≠n k·∫øt qu·∫£ giao h√†ng:
                                   </div>
                                   
                                   <div class="d-flex gap-3 justify-content-center">
                                        <!-- N√∫t ƒê√£ Giao H√†ng Th√†nh C√¥ng -->
                                        <button type="button" 
                                                th:onclick="|confirmStatusChange(${order.id}, 'DELIVERED')|"
                                                class="btn btn-success btn-lg px-4">
                                             <i class='bx bx-check-circle fs-18'></i> 
                                             <span class="ms-2">ƒê√£ Giao Th√†nh C√¥ng</span>
                                        </button>
                                        
                                        <!-- N√∫t Ho√†n Tr·∫£ H√†ng -->
                                        <button type="button" 
                                                th:onclick="|confirmStatusChange(${order.id}, 'RETURN')|"
                                                class="btn btn-warning btn-lg px-4">
                                             <i class='bx bx-undo fs-18'></i> 
                                             <span class="ms-2">Ho√†n Tr·∫£ H√†ng</span>
                                        </button>
                                   </div>
                                   
                                   <div class="text-center mt-3">
                                        <small class="text-muted">
                                             <i class='bx bx-time-five'></i> 
                                             Th·ªùi gian c·∫≠p nh·∫≠t cu·ªëi: 
                                             <span id="lastUpdateTime" class="fw-medium" th:text="${#dates.format(shipper.updatedDate, 'dd/MM/yyyy HH:mm')}"></span>
                                        </small>
                                   </div>
                              </div>
                         </div>
                              <div class="card bg-light-subtle" style="display: none;">
                                   <div class="card-body">
                                        <div class="row g-3 g-lg-0">
                                             <div class="col-lg-3 border-end">
                                                  <div class="d-flex align-items-center gap-3 justify-content-between px-3">
                                                       <div>
                                                            <p class="text-dark fw-medium fs-16 mb-1">Vender</p>
                                                            <p class="mb-0">Catpiller</p>
                                                       </div>
                                                       <div class="avatar bg-light d-flex align-items-center justify-content-center rounded">
                                                            <iconify-icon icon="solar:shop-2-bold-duotone" class="fs-35 text-primary"></iconify-icon>
                                                       </div>
                                                  </div>
                                             </div>
                                             <div class="col-lg-3 border-end">
                                                  <div class="d-flex align-items-center gap-3 justify-content-between px-3">
                                                       <div>
                                                            <p class="text-dark fw-medium fs-16 mb-1">Date</p>
                                                            <p class="mb-0">April 23 , 2024</p>
                                                       </div>
                                                       <div class="avatar bg-light d-flex align-items-center justify-content-center rounded">
                                                            <iconify-icon icon="solar:calendar-date-bold-duotone" class="fs-35 text-primary"></iconify-icon>
                                                       </div>
                                                  </div>
                                             </div>
                                             <div class="col-lg-3 border-end">
                                                  <div class="d-flex align-items-center gap-3 justify-content-between px-3">
                                                       <div>
                                                            <p class="text-dark fw-medium fs-16 mb-1">Paid By</p>
                                                            <p class="mb-0">Gaston Lapierre</p>
                                                       </div>
                                                       <div class="avatar bg-light d-flex align-items-center justify-content-center rounded">
                                                            <iconify-icon icon="solar:user-circle-bold-duotone" class="fs-35 text-primary"></iconify-icon>
                                                       </div>
                                                  </div>
                                             </div>
                                             <div class="col-lg-3">
                                                  <div class="d-flex align-items-center gap-3 justify-content-between px-3">
                                                       <div>
                                                            <p class="text-dark fw-medium fs-16 mb-1">Reference #IMEMO</p>
                                                            <p class="mb-0">#0758267/90</p>
                                                       </div>
                                                       <div class="avatar bg-light d-flex align-items-center justify-content-center rounded">
                                                            <iconify-icon icon="solar:clipboard-text-bold-duotone" class="fs-35 text-primary"></iconify-icon>
                                                       </div>
                                                  </div>
                                             </div>
                                        </div>
                                   </div>
                              </div>
                         </div>
                    </div>
                         </div>
                         <div class="col-xl-3 col-lg-4">
                              <div class="card">
                                   <div class="card-header">
                                        <h4 class="card-title">Order Summary</h4>
                                   </div>
                                   <div class="card-body">
                                        <div class="table-responsive">
                                             <table class="table mb-0">
                                                  <tbody>
                                                       <tr>
                                                            <td class="px-0">
                                                                 <p class="d-flex mb-0 align-items-center gap-1"><iconify-icon icon="solar:clipboard-text-broken"></iconify-icon> Sub Total : </p>
                                                            </td>
                                                            <td th:text="${payment.subtotal}" class="text-end text-dark fw-medium px-0"></td>
                                                       </tr>
                                                       <tr>
                                                            <td class="px-0">
                                                                 <p class="d-flex mb-0 align-items-center gap-1"><iconify-icon icon="solar:ticket-broken" class="align-middle"></iconify-icon> Discount : </p>
                                                            </td>
                                                            <td th:text="${payment.discount}" class="text-end text-dark fw-medium px-0"></td>
                                                       </tr>

                                                  </tbody>
                                             </table>
                                        </div>
                                   </div>
                                   <div class="card-footer d-flex align-items-center justify-content-between bg-light-subtle">
                                        <div>
                                             <p class="fw-medium text-dark mb-0">Total Amount</p>
                                        </div>
                                        <div>
                                             <p class="fw-medium text-dark mb-0" th:text="${payment.totalpay}"></p>
                                        </div>

                                   </div>
                              </div>

                              <div class="card">
                                   <div class="card-header">
                                        <h4 class="card-title">Customer Details</h4>
                                   </div>
                                   <div class="card-body">
                                        <div class="d-flex align-items-center gap-2">
                                             <img th:src="${user.profilePicture != null ? user.profilePicture : '/assets/images/users/avatar-1.jpg'}" 
                                                  alt="Customer Avatar" 
                                                  class="avatar rounded-3 border border-light border-3">
                                             <div>
                                                  <p th:text="${user.fullname}" class="mb-1"></p>
                                                  <a th:text="${user.email}" href="#!" class="link-primary fw-medium"></a>
                                             </div>
                                        </div>
                                        <div class="d-flex justify-content-between mt-3">
                                             <h5 class="">Contact Number</h5>
                                        </div>
                                        <p class="mb-1">
                                             <span th:if="${user.phone != null}" th:text="${user.phone}"></span>
                                             <span th:if="${user.phone == null}" class="text-muted">Ch∆∞a c√≥ s·ªë ƒëi·ªán tho·∫°i</span>
                                        </p>

                                        <div class="d-flex justify-content-between mt-3">
                                             <h5 class="">Shipping Address</h5>
                                        </div>

                                        <div>
                                             <p class="mb-1">
                                                  <span th:if="${order.address != null}">
                                                       <span th:text="${order.address.address_line}"></span><br/>
                                                       <span th:text="${order.address.city}"></span>, 
                                                       <span th:text="${order.address.country}"></span>
                                                  </span>
                                                  <span th:if="${order.address == null}" class="text-muted">Ch∆∞a c√≥ ƒë·ªãa ch·ªâ giao h√†ng</span>
                                             </p>
                                        </div>
                                   </div>
                              </div>
                         </div>
                    </div>
               </div>

          </div>
          <!-- End Container Fluid -->

          <!-- ========== Footer Start ========== -->
          <footer class="footer">
              <div class="container-fluid">
                  <div class="row">
                      <div class="col-12 text-center">
                          <script>document.write(new Date().getFullYear())</script> &copy; Larkon. Crafted by <iconify-icon icon="iconamoon:heart-duotone" class="fs-18 align-middle text-danger"></iconify-icon> <a
                              href="https://1.envato.market/techzaa" class="fw-bold footer-text" target="_blank">Techzaa</a>
                      </div>
                  </div>
              </div>
          </footer>
          <!-- ========== Footer End ========== -->

     </div>
     <!-- ==================================================== -->
     <!-- End Page Content -->
     <!-- ==================================================== -->

     </div>
     <!-- END Wrapper -->

     <!-- Confirmation Modal -->
     <div class="modal fade" id="confirmStatusModal" tabindex="-1" aria-labelledby="confirmStatusModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
               <div class="modal-content">
                    <div class="modal-header">
                         <h5 class="modal-title" id="confirmStatusModalLabel">
                              <i class='bx bx-question-mark'></i> X√°c Nh·∫≠n Thay ƒê·ªïi Tr·∫°ng Th√°i
                         </h5>
                         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                         <p id="confirmMessage"></p>
                    </div>
                    <div class="modal-footer">
                         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                              <i class='bx bx-x'></i> H·ªßy
                         </button>
                         <button type="button" class="btn btn-primary" id="btnConfirmStatus">
                              <i class='bx bx-check'></i> X√°c Nh·∫≠n
                         </button>
                    </div>
               </div>
          </div>
     </div>

     <!-- Vendor Javascript (Require in all Page) -->
     <script src="/assets/js/vendor.js"></script>

     <!-- App Javascript (Require in all Page) -->
     <script src="/assets/js/app.js"></script>

     <!-- Status Update Script -->
     <script>
     let currentOrderId = null;
     let currentNewStatus = null;

     /**
      * Hi·ªÉn th·ªã modal x√°c nh·∫≠n thay ƒë·ªïi tr·∫°ng th√°i
      */
     function confirmStatusChange(orderId, newStatus) {
          currentOrderId = orderId;
          currentNewStatus = newStatus;
          
          // Set message t√πy theo tr·∫°ng th√°i
          let message = '';
          if (newStatus === 'DELIVERED') {
               message = 'ƒê∆°n h√†ng #' + orderId + ' ƒë√£ ƒë∆∞·ª£c giao th√†nh c√¥ng?';
          } else if (newStatus === 'RETURN') {
               message = 'H√†ng b·ªã ho√†n tr·∫£ cho ƒë∆°n h√†ng #' + orderId + '?';
          }
          
          document.getElementById('confirmMessage').textContent = message;
          
          // Hi·ªÉn th·ªã modal
          const modal = new bootstrap.Modal(document.getElementById('confirmStatusModal'));
          modal.show();
     }

     /**
      * X·ª≠ l√Ω khi click n√∫t x√°c nh·∫≠n trong modal
      */
     document.getElementById('btnConfirmStatus').addEventListener('click', function() {
          if (!currentOrderId || !currentNewStatus) return;
          
          // Disable button ƒë·ªÉ tr√°nh click li√™n t·ª•c
          this.disabled = true;
          this.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span> ƒêang x·ª≠ l√Ω...';
          
          // G·ªçi AJAX ƒë·ªÉ update status
          updateOrderStatus(currentOrderId, currentNewStatus);
     });

     /**
      * G·ªçi API ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng
      */
     function updateOrderStatus(orderId, newStatus) {
          const endpoint = newStatus === 'DELIVERED' ? '/shipper/delivered' : '/shipper/return';
          
          $.ajax({
               url: endpoint,
               type: 'GET',
               data: { orderid: orderId },
               success: function(response) {
                    console.log('‚úÖ Status updated successfully');
                    
                    // ƒê√≥ng modal
                    bootstrap.Modal.getInstance(document.getElementById('confirmStatusModal')).hide();
                    
                    // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                    showSuccessMessage(newStatus);
                    
                    // C·∫≠p nh·∫≠t UI
                    updatePageUI(newStatus);
                    
                    // Reload page sau 2 gi√¢y
                    setTimeout(function() {
                         location.reload();
                    }, 2000);
               },
               error: function(xhr, status, error) {
                    console.error('‚ùå Error updating status:', error);
                    
                    // ƒê√≥ng modal
                    bootstrap.Modal.getInstance(document.getElementById('confirmStatusModal')).hide();
                    
                    // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
                    alert('‚ùå L·ªói: Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i. Vui l√≤ng th·ª≠ l·∫°i!');
                    
                    // Reset button
                    const btn = document.getElementById('btnConfirmStatus');
                    btn.disabled = false;
                    btn.innerHTML = '<i class="bx bx-check"></i> X√°c Nh·∫≠n';
               }
          });
     }

     /**
      * Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
      */
     function showSuccessMessage(newStatus) {
          const message = newStatus === 'DELIVERED' 
               ? '‚úÖ ƒê√£ ƒë√°nh d·∫•u ƒë∆°n h√†ng ƒë√£ giao th√†nh c√¥ng!' 
               : '‚úÖ ƒê√£ ƒë√°nh d·∫•u ƒë∆°n h√†ng ho√†n tr·∫£!';
          
          // T·∫°o alert element
          const alertDiv = document.createElement('div');
          alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
          alertDiv.style.zIndex = '9999';
          alertDiv.innerHTML = `
               ${message}
               <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          `;
          
          document.body.appendChild(alertDiv);
          
          // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
          setTimeout(function() {
               alertDiv.remove();
          }, 3000);
     }

     /**
      * C·∫≠p nh·∫≠t UI sau khi thay ƒë·ªïi tr·∫°ng th√°i
      */
     function updatePageUI(newStatus) {
          // Map status sang ti·∫øng Vi·ªát
          const statusMap = {
               'IN_STOCK': 'Ch·ªù X√°c Nh·∫≠n',
               'SHIPPED': 'ƒêang Giao H√†ng',
               'DELIVERED': 'ƒê√£ Giao',
               'CANCEL': 'ƒê√£ H·ªßy',
               'RETURN': 'ƒê√£ Tr·∫£ H√†ng'
          };
          
          // C·∫≠p nh·∫≠t badge tr·∫°ng th√°i
          const statusBadge = document.getElementById('status');
          if (statusBadge) {
               statusBadge.textContent = statusMap[newStatus] || newStatus;
               
               // ƒê·ªïi m√†u badge
               statusBadge.className = 'fs-13 px-2 py-1 rounded';
               if (newStatus === 'DELIVERED') {
                    statusBadge.classList.add('border', 'border-success', 'text-success');
               } else if (newStatus === 'RETURN') {
                    statusBadge.classList.add('border', 'border-danger', 'text-danger');
               } else if (newStatus === 'SHIPPED') {
                    statusBadge.classList.add('border', 'border-warning', 'text-warning');
               } else if (newStatus === 'CANCEL') {
                    statusBadge.classList.add('border', 'border-secondary', 'text-secondary');
               }
          }
          
          // ·∫®n to√†n b·ªô section Action Buttons
          const actionSection = document.querySelector('.card-body.border-top');
          if (actionSection) {
               actionSection.style.display = 'none';
          }
          
          // C·∫≠p nh·∫≠t th·ªùi gian
          const lastUpdateTimeEl = document.getElementById('lastUpdateTime');
          if (lastUpdateTimeEl) {
               const now = new Date();
               const formattedDate = now.toLocaleString('vi-VN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
               });
               lastUpdateTimeEl.textContent = formattedDate;
          }
     }
     
     /**
      * L∆∞u ghi ch√∫ c·ªßa shipper
      */
     function saveNote(shipmentId) {
          const noteTextarea = document.getElementById('shipperNote');
          const note = noteTextarea.value.trim();
          
          if (!note) {
               alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p n·ªôi dung ghi ch√∫!');
               noteTextarea.focus();
               return;
          }
          
          // Disable button ƒë·ªÉ tr√°nh click nhi·ªÅu l·∫ßn
          const saveBtn = event.target;
          saveBtn.disabled = true;
          saveBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span> ƒêang l∆∞u...';
          
          console.log('üíæ Saving note:', note, 'for shipment:', shipmentId);
          
          $.ajax({
               url: '/shipper/note',
               type: 'POST',
               data: {
                    note: note,
                    shipmentId: shipmentId
               },
               success: function(response) {
                    console.log('‚úÖ Note saved successfully:', response);
                    
                    // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
                    alertDiv.style.zIndex = '9999';
                    alertDiv.innerHTML = `
                         ‚úÖ ƒê√£ l∆∞u ghi ch√∫ th√†nh c√¥ng!
                         <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.body.appendChild(alertDiv);
                    
                    setTimeout(() => alertDiv.remove(), 3000);
                    
                    // Reset button
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="bx bx-save"></i> L∆∞u Ghi Ch√∫';
               },
               error: function(xhr, status, error) {
                    console.error('‚ùå Error saving note:', error);
                    alert('‚ùå L·ªói: Kh√¥ng th·ªÉ l∆∞u ghi ch√∫. Vui l√≤ng th·ª≠ l·∫°i!');
                    
                    // Reset button
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="bx bx-save"></i> L∆∞u Ghi Ch√∫';
               }
          });
     }
     </script>

</body>


<!-- Mirrored from techzaa.in/larkon/admin/order-detail.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Nov 2024 14:46:47 GMT -->
</html>